<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¸ˆå§å¿ƒæƒ…æ¨¡æ‹Ÿå™¨ </title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            background-color: #f5f5f5;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
        }

        .option-btn:hover {
            background-color: #f0f7ff;
        }

        .progress-bar {
            height: 12px;
            border-radius: 6px;
            background-color: #e2e8f0;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            border-radius: 6px;
            transition: width 0.5s ease-out;
        }

        @keyframes timerAnimation {
            from {
                width: 100%;
                background-color: #60a5fa;
            }

            50% {
                background-color: #f59e0b;
            }

            to {
                width: 0%;
                background-color: #ef4444;
            }
        }

        .timer-bar {
            height: 6px;
            border-radius: 3px;
            background-color: #60a5fa;
            width: 100%;
            animation-name: timerAnimation;
            animation-timing-function: linear;
            animation-play-state: paused;
        }

        .timer-active {
            animation-play-state: running;
        }

        .event-notification {
            animation: fadeInOut 4s ease-in-out;
            opacity: 0;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 50;
        }

        @keyframes fadeInOut {
            0% {
                opacity: 0;
            }

            10% {
                opacity: 1;
            }

            80% {
                opacity: 1;
            }

            100% {
                opacity: 0;
            }
        }
    </style>
</head>

<body class="bg-gray-100">
    <div class="max-w-md mx-auto bg-white shadow-sm min-h-screen relative">
        <!-- é¡¶éƒ¨æ ‡é¢˜ -->
        <div class="text-center py-4 border-b border-gray-200">
            <h1 class="text-xl font-bold text-red-800">å¸ˆå§å¿ƒæƒ…æ¨¡æ‹Ÿå™¨</h1>
            <p class="text-gray-500 text-sm">zkxè§†è§’æ¨¡æ‹Ÿå™¨</p>
        </div>

        <!-- éšæœºäº‹ä»¶é€šçŸ¥ -->
        <div id="event-notification" class="event-notification hidden">
            <div class="bg-red-100 border-l-4 border-red-600 text-red-700 p-4 rounded shadow-lg">
                <p class="font-bold mb-1" id="event-title">çªå‘äº‹ä»¶</p>
                <p id="event-desc">é­”é­”çªç„¶æƒ³èµ·äº†ä½ ä¸Šä¸ªæœˆå¿˜è®°å¥¹ç”Ÿæ—¥çš„äº‹æƒ…ï¼</p>
            </div>
        </div>

        <!-- æ¸¸æˆç•Œé¢å®¹å™¨ -->
        <div id="game-container">
            <!-- å¼€å§‹æ¸¸æˆç•Œé¢ -->
            <div id="start-screen" class="p-4">
                <h2 class="text-lg font-bold mb-4 text-red-800">å¸ˆå§å¿ƒæƒ…æ¨¡æ‹Ÿå™¨</h2>

                <p class="mb-3 font-bold text-red-700">è­¦å‘Šï¼šä½ å›ç­”é—®é¢˜æ‰€ç”¨æ—¶é—´ä¼šå½±å“åˆ°å¸ˆå§è€å¿ƒï¼Œå› æ­¤å¿…é¡»è¿…é€Ÿç­”é¢˜ï¼</p>

                <div class="my-4 bg-gray-50 p-3 rounded">
                    <h3 class="font-bold mb-2">æ¸¸æˆè§„åˆ™ï¼š</h3>
                    <ul class="mb-3 pl-4 space-y-1 text-sm">
                        <li>â€¢ åˆå§‹æ•°å€¼ä¸º30</li>
                        <li>â€¢ èƒœåˆ©æ¡ä»¶ï¼šå¸ˆå§å¿ƒæƒ…å’Œä½ çš„çŸ¥è¯†æ°´å¹³éœ€è¾¾95+</li>
                        <li>â€¢ å›åˆæ•°åªæœ‰10è½®</li>
                        <li>â€¢ å¸ˆå§å¿ƒæƒ…æ¯è½®è‡ªåŠ¨è¡°å‡</li>
                        <li>â€¢ éšæœºäº‹ä»¶ä¼šçªç„¶é™ä½è¿›åº¦</li>
                        <li>â€¢ åŒç±»é€‰é¡¹é‡å¤ä½¿ç”¨æ•ˆæœå¤§å¹…ä¸‹é™</li>
                        <li>â€¢ æ—¶é—´å‹åŠ›ï¼šæ¯è½®é€‰æ‹©é™æ—¶30ç§’</li>
                        <li>â€¢ å¿ƒæƒ…ä½äº40æ—¶ï¼Œæ‰€æœ‰é€‰é¡¹æ•ˆæœå‡åŠ</li>
                    </ul>
                </div>

                <button id="start-game-btn"
                    class="w-full py-2 bg-red-100 text-red-800 border border-red-200 rounded text-center">
                    å¼€å§‹æŒ‘æˆ˜
                </button>
            </div>

            <!-- ä¸»æ¸¸æˆç•Œé¢ -->
            <div id="main-game-screen" class="hidden">
                <!-- æƒ…æ™¯æè¿° -->
                <div class="p-4">
                    <p id="scene-description" class="text-gray-700">
                        ä½ ååœ¨é­”é­”çš„æˆ¿é—´é‡Œï¼Œå¥¹éå¸¸ç”Ÿæ°”åœ°çœ‹ç€ä½ ã€‚ä½ ä¹‹å‰è¯´çš„è¯æ·±æ·±ä¼¤å®³äº†å¥¹ï¼Œç°åœ¨éœ€è¦è¿…é€Ÿè§£å†³è¿™ä¸ªå±æœºã€‚
                    </p>

                    <div class="my-4 pl-3 border-l-4 border-red-500">
                        <p class="font-bold text-red-600 mb-1">é­”é­”ï¼š</p>
                        <p id="momo-quote" class="text-gray-800">"ä¸æƒ³ç†ä½ äº†ï¼ä½ æ ¹æœ¬ä¸åœ¨ä¹æˆ‘çš„æ„Ÿå—ï¼"</p>
                    </div>

                    <!-- <div id="momo-needs" class="my-3 px-3 py-2 bg-red-50 text-sm text-red-700 rounded">
                        <p class="font-medium">é­”é­”çš„å½“å‰éœ€æ±‚ï¼š<span id="current-need">æœªçŸ¥</span></p>
                    </div> -->
                </div>

                <!-- çŠ¶æ€æŒ‡æ ‡ -->
                <div class="px-4 py-3 bg-gray-50">
                    <!-- é­”é­”å¿ƒæƒ…å€¼ -->
                    <div class="flex justify-between items-center mb-1">
                        <span class="text-sm text-gray-600">é­”é­”å¿ƒæƒ…å€¼</span>
                        <div class="flex items-center">
                            <span id="momo-mood-emoji" class="mr-1">ğŸ˜ </span>
                            <span id="momo-mood-value" class="text-sm font-medium">30</span>
                        </div>
                    </div>
                    <div class="progress-bar mb-3">
                        <div id="momo-mood-bar" class="progress-fill bg-red-500" style="width: 30%"></div>
                    </div>

                    <!-- é­”é­”å–œæ¬¢ä½ å€¼ -->
                    <div class="flex justify-between items-center mb-1">
                        <span class="text-sm text-gray-600">é­”é­”å–œæ¬¢ä½ å€¼</span>
                        <div class="flex items-center">
                            <span id="momo-love-emoji" class="mr-1">ğŸ’”</span>
                            <span id="momo-love-value" class="text-sm font-medium">30</span>
                        </div>
                    </div>
                    <div class="progress-bar mb-3">
                        <div id="momo-love-bar" class="progress-fill bg-red-500" style="width: 30%"></div>
                    </div>

                    <!-- ä½ å¿ƒæƒ…å€¼ -->
                    <!-- <div class="flex justify-between items-center mb-1">
                        <span class="text-sm text-gray-600">ä½ å¿ƒæƒ…å€¼</span>
                        <div class="flex items-center">
                            <span id="koko-mood-emoji" class="mr-1">ğŸ˜°</span>
                            <span id="koko-mood-value" class="text-sm font-medium">30</span>
                        </div>
                    </div>
                    <div class="progress-bar">
                        <div id="koko-mood-bar" class="progress-fill bg-red-500" style="width: 30%"></div>
                    </div> -->
                </div>

                <!-- å›åˆå’Œå€’è®¡æ—¶ -->
                <div class="p-4 pt-2 pb-0 flex justify-between items-center">
                    <span class="text-sm font-medium" id="round-counter">ç¬¬1/10è½®</span>
                    <span class="text-sm font-medium" id="timer-text">å‰©ä½™æ—¶é—´: 30ç§’</span>
                </div>
                <div class="px-4 pt-1 pb-1">
                    <div class="timer-bar" id="timer-bar"></div>
                </div>

                <!-- é€‰é¡¹åŒºåŸŸ -->
                <div id="options-container" class="p-4">
                    <!-- é€‰é¡¹å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                </div>
            </div>

            <!-- ç»“æœç•Œé¢ -->
            <div id="result-screen" class="hidden p-4">
                <div class="border-l-4 pl-3 mb-6" id="result-border">
                    <h2 id="result-title" class="text-lg font-bold mb-2">æ¸¸æˆç»“æŸ</h2>

                    <p id="result-desc" class="mb-4">
                        ç»“æœæè¿°...
                    </p>

                    <div class="mb-4">
                        <p class="font-medium mb-1">æœ€ç»ˆæŒ‡æ ‡ï¼š</p>
                        <div class="flex justify-between items-center mb-1">
                            <span class="text-sm">é­”é­”å¿ƒæƒ…å€¼ï¼š</span>
                            <div class="flex items-center">
                                <span id="final-momo-emoji" class="mr-1">ğŸ˜Š</span>
                                <span id="final-momo-mood" class="font-medium">85</span>
                            </div>
                        </div>
                        <div class="flex justify-between items-center mb-1">
                            <span class="text-sm">é­”é­”å–œæ¬¢ä½ å€¼ï¼š</span>
                            <div class="flex items-center">
                                <span id="final-love-emoji" class="mr-1">â¤ï¸</span>
                                <span id="final-momo-love" class="font-medium">80</span>
                            </div>
                        </div>
                        <!-- <div class="flex justify-between items-center">
                            <span class="text-sm">ä½ å¿ƒæƒ…å€¼ï¼š</span>
                            <div class="flex items-center">
                                <span id="final-koko-emoji" class="mr-1">ğŸ˜Œ</span>
                                <span id="final-koko-mood" class="font-medium">60</span>
                            </div>
                        </div> -->
                    </div>

                    <p id="momo-final-quote" class="italic text-gray-700 mb-3">"é­”é­”çš„æœ€ç»ˆè¯„ä»·..."</p>

                    <div class="bg-gray-50 p-3 rounded mb-4 text-sm">
                        <p class="font-medium mb-1">æ¸¸æˆæ•°æ®ï¼š</p>
                        <div class="flex justify-between mb-1">
                            <span>æ€»å…±é€‰æ‹©çš„è¡ŒåŠ¨ï¼š</span>
                            <span id="total-actions">8</span>
                        </div>
                        <div class="flex justify-between mb-1">
                            <span>è§¦å‘çš„éšæœºäº‹ä»¶ï¼š</span>
                            <span id="random-events">2</span>
                        </div>
                        <div class="flex justify-between">
                            <span>é€‰é¡¹è¶…æ—¶æ¬¡æ•°ï¼š</span>
                            <span id="timeout-count">1</span>
                        </div>
                    </div>
                </div>

                <button id="restart-game-btn"
                    class="w-full py-2 bg-red-100 text-red-800 border border-red-200 rounded text-center">
                    é‡æ–°æŒ‘æˆ˜
                </button>
            </div>
        </div>
    </div>

    <script>
        // æ¸¸æˆçŠ¶æ€
        const gameState = {
            score: 30,           // ç©å®¶å¾—åˆ†ï¼Œæ›¿æ¢åŸæ¥çš„momoMood
            correctAnswers: 30,  // æ­£ç¡®å›ç­”æ•°ï¼Œæ›¿æ¢åŸæ¥çš„momoLove
            gameOver: false,     // æ¸¸æˆæ˜¯å¦ç»“æŸ
            round: 0,            // å½“å‰è½®æ•°
            maxRounds: 10,       // æœ€å¤§è½®æ•°
            timeoutCount: 0,     // è¶…æ—¶æ¬¡æ•°
            eventCount: 0,       // éšæœºäº‹ä»¶è§¦å‘æ¬¡æ•°
            lastQuestionType: null, // ä¸Šä¸€æ¬¡é—®é¢˜çš„ç±»å‹
            currentQuestion: null,  // å½“å‰é—®é¢˜
            timerDuration: 30    // è®¡æ—¶å™¨æŒç»­æ—¶é—´ï¼ˆç§’ï¼‰
        };

        // é—®é¢˜ç±»å‹
        const questionTypes = {
            COIP: "COIP",
            WB: "Western Blot",
            PROTEIN: "è›‹ç™½çº¯åŒ–",
            CLONING: "åˆ†å­å…‹éš†",
            PCR: "PCRæŠ€æœ¯",
            GEL: "å‡èƒ¶ç”µæ³³",
            CELL: "ç»†èƒåŸ¹å…»"
        };


        // é—®é¢˜éš¾åº¦æè¿°
        const difficultyDescriptions = {
            [questionTypes.COIP]: "COIPæŠ€æœ¯é—®é¢˜",
            [questionTypes.WB]: "Western Bloté—®é¢˜",
            [questionTypes.PROTEIN]: "è›‹ç™½çº¯åŒ–é—®é¢˜",
            [questionTypes.CLONING]: "åˆ†å­å…‹éš†é—®é¢˜",
            [questionTypes.PCR]: "PCRæŠ€æœ¯é—®é¢˜",
            [questionTypes.GEL]: "å‡èƒ¶ç”µæ³³é—®é¢˜",
            [questionTypes.CELL]: "ç»†èƒåŸ¹å…»é—®é¢˜"
        };

        // // é­”é­”çš„è´Ÿé¢å’Œæ­£é¢è¯è¯­
        // const momoNegativePhrases = [
        //     "ä¸ç†ä½ äº†ï¼å‹¾çŸ³ï¼",
        //     "ä½ æ ¹æœ¬ä¸æ‡‚æˆ‘ï¼",
        //     "æˆ‘å¾ˆç”Ÿæ°”ï¼",
        //     "ä½ æ€»æ˜¯è¿™æ ·ï¼",
        //     "æˆ‘æ¨æ­»ä½ äº†ï¼",
        //     "ä½ æ ¹æœ¬ä¸åœ¨ä¹æˆ‘ï¼",
        //     "æˆ‘æ„Ÿè§‰ä½ ä¸€ç‚¹éƒ½ä¸çˆ±æˆ‘...",
        //     "ä½ å°±çŸ¥é“å·¥ä½œï¼Œéƒ½ä¸é™ªæˆ‘ï¼"
        // ];

        // const momoPositivePhrases = [
        //     "æ£’æ£’ï¼",
        //     "çœŸå¯çˆ±~",
        //     "èµçŒ«ï¼",
        //     "ä½ æœ€å¥½äº†ï¼",
        //     "å‹‰å¼ºåŸè°…ä½ ä¸€ä¸‹ä¸‹~",
        //     "å—¯...ä½ è¿˜ç®—æœ‰ç‚¹è‰¯å¿ƒ",
        //     "å¥½å•¦å¥½å•¦ï¼Œä¸ç”Ÿæ°”äº†~",
        //     "ä½ ï¼Œçˆ±ä½ å“¦~"
        // ];

        // å¸ˆå§çš„è´Ÿé¢å’Œæ­£é¢è¯„è¯­
        const negativeFeedback = [
            "è¿™éƒ½ä¸ä¼šï¼Ÿä½ ç¡®å®šå­¦è¿‡ç”Ÿç‰©å—ï¼Ÿ",
            "è¿™ä¹ˆç®€å•çš„é—®é¢˜éƒ½ç­”é”™ï¼Œå†è®¤çœŸæƒ³æƒ³ï¼",
            "ä¸å¯¹ï¼Œè¿™æ˜¯åŸºç¡€çŸ¥è¯†ï¼Œè¦å¤ä¹ ä¸€ä¸‹äº†ã€‚",
            "å·®è¿œäº†ï¼Œé‡æ–°çœ‹çœ‹æ•™æå§ï¼",
            "è¿™ä¸ªç­”æ¡ˆå®Œå…¨ä¸å¯¹ï¼Œä½ å†æƒ³æƒ³ï¼Ÿ",
            "é”™è¯¯ï¼Œä½ æ˜¯ä¸æ˜¯æ²¡å¬è¯¾ï¼Ÿ",
            "ä¸è¡Œä¸è¡Œï¼ŒåŸºç¡€å¤ªå·®äº†ï¼",
            "è¿™ä¸ªéƒ½ä¸çŸ¥é“ï¼Œè¦åŠ æ²¹äº†ï¼"
        ];

        const positiveFeedback = [
            "å›ç­”æ­£ç¡®ï¼ŒçœŸæ£’ï¼",
            "å¾ˆå¥½ï¼Œçœ‹æ¥ä½ æŒæ¡å¾—ä¸é”™ï¼",
            "å¯¹ï¼Œå°±æ˜¯è¿™æ ·ï¼",
            "ç­”å¯¹äº†ï¼Œç»§ç»­ä¿æŒï¼",
            "éå¸¸å¥½ï¼Œä½ ç†è§£å¾—å¾ˆé€å½»ï¼",
            "æ­£ç¡®ï¼ä½ çš„åŸºç¡€æ‰“å¾—å¾ˆç‰¢å›ºï¼",
            "å¯¹çš„ï¼Œä½ æŒæ¡äº†è¦ç‚¹ï¼",
            "å®Œå…¨æ­£ç¡®ï¼Œä½ å¾ˆæœ‰å¤©èµ‹ï¼"
        ];


        // éšæœºäº‹ä»¶
        const randomEventsData = [
            {
                title: "çªå‘é—®é¢˜",
                desc: "å¸ˆå§çªç„¶æƒ³èµ·ä¸€ä¸ªéš¾é¢˜è¦è€ƒä½ ï¼",
                scoreEffect: -15,
                correctEffect: -10
            },
            {
                title: "å®éªŒå®¤ç´§æ€¥æƒ…å†µ",
                desc: "å®éªŒå®¤çš„ç¦»å¿ƒæœºå‡ºäº†æ•…éšœï¼Œåˆ†æ•£äº†ä½ çš„æ³¨æ„åŠ›ï¼",
                scoreEffect: -10,
                correctEffect: -15
            },
            {
                title: "æ€è·¯æ··ä¹±",
                desc: "ä½ çªç„¶å‘ç°è‡ªå·±çš„ç¬”è®°æ··ä¹±äº†ï¼ŒçŸ¥è¯†ç‚¹å…¨ææ··äº†...",
                scoreEffect: -20,
                correctEffect: -5
            },
            {
                title: "ç–²åŠ³å½±å“",
                desc: "è¿ç»­å®éªŒè®©ä½ å¤ªç–²åŠ³ï¼Œæ€ç»´å˜å¾—è¿Ÿé’ï¼",
                scoreEffect: -15,
                correctEffect: -15
            },
            {
                title: "çŸ¥è¯†æ¼æ´",
                desc: "ä½ å‘ç°æœ‰ä¸€ç« å†…å®¹å®Œå…¨æ²¡å¤ä¹ ...",
                scoreEffect: -5,
                correctEffect: -20
            }
        ];

       


        // é—®é¢˜æ± 
        const questionPool = [
            // COIPé—®é¢˜
            {
                question: "åœ¨Co-IPå®éªŒä¸­ï¼Œä¸ºä»€ä¹ˆéœ€è¦ä½¿ç”¨æŠ—ä½“ï¼Ÿ",
                answers: [
                    { text: "æŠ—ä½“å¯ä»¥ç‰¹å¼‚æ€§ç»“åˆç›®æ ‡è›‹ç™½ï¼Œç”¨äºæ²‰æ·€è›‹ç™½è´¨å¤åˆç‰©", isCorrect: true },
                    { text: "æŠ—ä½“å¯ä»¥é˜»æ–­éç‰¹å¼‚æ€§ç»“åˆï¼Œå‡å°‘èƒŒæ™¯ä¿¡å·", isCorrect: false },
                    { text: "æŠ—ä½“å¯ä»¥é™è§£RNAï¼Œé˜²æ­¢RNAå¹²æ‰°å®éªŒç»“æœ", isCorrect: false },
                    { text: "æŠ—ä½“å¯ä»¥å¢å¼ºè›‹ç™½è´¨è¡¨è¾¾ï¼Œæé«˜æ£€æµ‹çµæ•åº¦", isCorrect: false }
                ],
                type: questionTypes.COIP
            },
            {
                question: "Co-IPå®éªŒä¸­ï¼Œæ´—æ¶¤æ­¥éª¤çš„ä¸»è¦ç›®çš„æ˜¯ä»€ä¹ˆï¼Ÿ",
                answers: [
                    { text: "å»é™¤éç‰¹å¼‚æ€§ç»“åˆçš„è›‹ç™½è´¨", isCorrect: true },
                    { text: "æ´»åŒ–æŠ—ä½“ç»“åˆä½ç‚¹", isCorrect: false },
                    { text: "æ‰“æ–­è›‹ç™½è´¨ä¹‹é—´çš„ç›¸äº’ä½œç”¨", isCorrect: false },
                    { text: "æé«˜è›‹ç™½è´¨çš„æº¶è§£åº¦", isCorrect: false }
                ],
                type: questionTypes.COIP
            },
            {
                question: "åœ¨Co-IPå®éªŒä¸­ï¼Œä»€ä¹ˆå› ç´ å¯èƒ½å¯¼è‡´å‡é˜´æ€§ç»“æœï¼Ÿ",
                answers: [
                    { text: "ç›¸äº’ä½œç”¨è›‹ç™½çš„è¡¨è¾¾é‡å¤ªä½", isCorrect: true },
                    { text: "ä½¿ç”¨äº†è¿‡å¤šçš„æŠ—ä½“", isCorrect: false },
                    { text: "ç¼“å†²æ¶²pHå€¼è¿‡é«˜", isCorrect: false },
                    { text: "æ ·å“å¤„ç†æ—¶é—´è¿‡é•¿", isCorrect: false }
                ],
                type: questionTypes.COIP
            },

            // Western Bloté—®é¢˜
            {
                question: "Western Blotå®éªŒä¸­ï¼Œè›‹ç™½è´¨è½¬ç§»åˆ°è†œä¸Šçš„é©±åŠ¨åŠ›æ˜¯ä»€ä¹ˆï¼Ÿ",
                answers: [
                    { text: "ç”µåœºåŠ›", isCorrect: true },
                    { text: "æ¸—é€å‹", isCorrect: false },
                    { text: "ç¦»å¿ƒåŠ›", isCorrect: false },
                    { text: "è¡¨é¢å¼ åŠ›", isCorrect: false }
                ],
                type: questionTypes.WB
            },
            {
                question: "Western Blotä¸­ï¼Œå°é—­æ­¥éª¤çš„ä¸»è¦ç›®çš„æ˜¯ä»€ä¹ˆï¼Ÿ",
                answers: [
                    { text: "é˜»æ­¢æŠ—ä½“éç‰¹å¼‚æ€§ç»“åˆåˆ°è†œä¸Š", isCorrect: true },
                    { text: "å¢å¼ºè›‹ç™½è´¨ä¸è†œçš„ç»“åˆ", isCorrect: false },
                    { text: "å»é™¤å¤šä½™çš„SDS", isCorrect: false },
                    { text: "å›ºå®šè›‹ç™½è´¨åœ¨è†œä¸Šçš„ä½ç½®", isCorrect: false }
                ],
                type: questionTypes.WB
            },
            {
                question: "Western Blotæ£€æµ‹ä¸­å¸¸ç”¨çš„æ˜¾è‰²åº•ç‰©ä¸åŒ…æ‹¬ï¼š",
                answers: [
                    { text: "DNAèšåˆé…¶", isCorrect: true },
                    { text: "ECLè¯•å‰‚", isCorrect: false },
                    { text: "NBT/BCIP", isCorrect: false },
                    { text: "DAB", isCorrect: false }
                ],
                type: questionTypes.WB
            },

            // è›‹ç™½çº¯åŒ–é—®é¢˜
            {
                question: "ä»¥ä¸‹å“ªç§æ–¹æ³•ä¸é€‚ç”¨äºè›‹ç™½è´¨çš„åˆæ­¥çº¯åŒ–ï¼Ÿ",
                answers: [
                    { text: "è´¨è°±åˆ†æ", isCorrect: true },
                    { text: "ç›ææ³•", isCorrect: false },
                    { text: "ç¦»å­äº¤æ¢è‰²è°±", isCorrect: false },
                    { text: "åˆ†å­ç­›è‰²è°±", isCorrect: false }
                ],
                type: questionTypes.PROTEIN
            },
            {
                question: "äº²å’Œè‰²è°±æ³•çº¯åŒ–è›‹ç™½è´¨çš„åŸç†æ˜¯åŸºäºï¼š",
                answers: [
                    { text: "è›‹ç™½è´¨ä¸é…ä½“ä¹‹é—´çš„ç‰¹å¼‚æ€§ç›¸äº’ä½œç”¨", isCorrect: true },
                    { text: "è›‹ç™½è´¨åˆ†å­é‡çš„å·®å¼‚", isCorrect: false },
                    { text: "è›‹ç™½è´¨ç­‰ç”µç‚¹çš„å·®å¼‚", isCorrect: false },
                    { text: "è›‹ç™½è´¨ç–æ°´æ€§çš„å·®å¼‚", isCorrect: false }
                ],
                type: questionTypes.PROTEIN
            },
            {
                question: "åœ¨His-tagè›‹ç™½çº¯åŒ–ä¸­ï¼Œå¸¸ç”¨ä»€ä¹ˆç‰©è´¨æ´—è„±ç›®æ ‡è›‹ç™½ï¼Ÿ",
                answers: [
                    { text: "å’ªå”‘ï¼ˆImidazoleï¼‰", isCorrect: true },
                    { text: "æ°¯åŒ–é’ ï¼ˆNaClï¼‰", isCorrect: false },
                    { text: "å°¿ç´ ï¼ˆUreaï¼‰", isCorrect: false },
                    { text: "ç”˜æ°¨é…¸ï¼ˆGlycineï¼‰", isCorrect: false }
                ],
                type: questionTypes.PROTEIN
            },

            // åˆ†å­å…‹éš†é—®é¢˜
            {
                question: "åœ¨æ„å»ºé‡ç»„è´¨ç²’æ—¶ï¼Œè¿æ¥é…¶çš„ä¸»è¦åŠŸèƒ½æ˜¯ï¼š",
                answers: [
                    { text: "åœ¨DNAç‰‡æ®µä¹‹é—´å½¢æˆç£·é…¸äºŒé…¯é”®", isCorrect: true },
                    { text: "åˆ‡å‰²DNAç‰¹å®šä½ç‚¹", isCorrect: false },
                    { text: "è§£æ—‹DNAåŒé“¾", isCorrect: false },
                    { text: "åˆæˆæ–°çš„DNAé“¾", isCorrect: false }
                ],
                type: questionTypes.CLONING
            },
            {
                question: "ä»¥ä¸‹å“ªç§é…¶ä¸å¸¸ç”¨äºåˆ†å­å…‹éš†ï¼Ÿ",
                answers: [
                    { text: "RNAèšåˆé…¶II", isCorrect: true },
                    { text: "é™åˆ¶æ€§å†…åˆ‡é…¶", isCorrect: false },
                    { text: "DNAè¿æ¥é…¶", isCorrect: false },
                    { text: "ç¢±æ€§ç£·é…¸é…¶", isCorrect: false }
                ],
                type: questionTypes.CLONING
            },
            {
                question: "Gatewayå…‹éš†æŠ€æœ¯çš„åŸç†åŸºäºï¼š",
                answers: [
                    { text: "ä½ç‚¹ç‰¹å¼‚æ€§é‡ç»„", isCorrect: true },
                    { text: "åŒæºé‡ç»„", isCorrect: false },
                    { text: "é™åˆ¶æ€§é…¶åˆ‡å’Œè¿æ¥", isCorrect: false },
                    { text: "PCRæ‰©å¢", isCorrect: false }
                ],
                type: questionTypes.CLONING
            },

            // PCRæŠ€æœ¯é—®é¢˜
            {
                question: "Real-time PCRä¸­ï¼ŒSYBR Greençš„ä½œç”¨æ˜¯ï¼š",
                answers: [
                    { text: "ä¸åŒé“¾DNAç»“åˆå‘å‡ºè§å…‰", isCorrect: true },
                    { text: "å¢åŠ PCRååº”çš„ç‰¹å¼‚æ€§", isCorrect: false },
                    { text: "é™ä½PCRååº”çš„æ¸©åº¦", isCorrect: false },
                    { text: "å»¶é•¿å¼•ç‰©çš„é•¿åº¦", isCorrect: false }
                ],
                type: questionTypes.PCR
            },
            {
                question: "PCRååº”ä¸­ï¼Œé€€ç«æ¸©åº¦ä¸»è¦å–å†³äºï¼š",
                answers: [
                    { text: "å¼•ç‰©çš„é•¿åº¦å’ŒGCå«é‡", isCorrect: true },
                    { text: "æ¨¡æ¿DNAçš„é•¿åº¦", isCorrect: false },
                    { text: "dNTPçš„æµ“åº¦", isCorrect: false },
                    { text: "Taqé…¶çš„æ´»æ€§", isCorrect: false }
                ],
                type: questionTypes.PCR
            },
            {
                question: "ä»¥ä¸‹å“ªç§PCRæŠ€æœ¯ä¸ç”¨äºåŸºå› è¡¨è¾¾åˆ†æï¼Ÿ",
                answers: [
                    { text: "å·¢å¼PCRï¼ˆNested PCRï¼‰", isCorrect: true },
                    { text: "å®æ—¶å®šé‡PCRï¼ˆReal-time PCRï¼‰", isCorrect: false },
                    { text: "åè½¬å½•PCRï¼ˆRT-PCRï¼‰", isCorrect: false },
                    { text: "æ•°å­—PCRï¼ˆDigital PCRï¼‰", isCorrect: false }
                ],
                type: questionTypes.PCR
            },

            // å‡èƒ¶ç”µæ³³é—®é¢˜
            {
                question: "åœ¨DNAç¼è„‚ç³–å‡èƒ¶ç”µæ³³ä¸­ï¼ŒDNAè¿ç§»é€Ÿç‡ä¸»è¦å–å†³äºï¼š",
                answers: [
                    { text: "DNAç‰‡æ®µçš„å¤§å°", isCorrect: true },
                    { text: "DNAçš„ç¢±åŸºç»„æˆ", isCorrect: false },
                    { text: "DNAçš„ç”²åŸºåŒ–ç¨‹åº¦", isCorrect: false },
                    { text: "DNAçš„äºŒçº§ç»“æ„", isCorrect: false }
                ],
                type: questionTypes.GEL
            },
            {
                question: "SDS-PAGEä¸­SDSçš„ä¸»è¦ä½œç”¨æ˜¯ï¼š",
                answers: [
                    { text: "ä½¿è›‹ç™½è´¨å˜æ€§å¹¶èµ‹äºˆç»Ÿä¸€çš„è´Ÿç”µè·", isCorrect: true },
                    { text: "å¢åŠ å‡èƒ¶çš„å¼ºåº¦", isCorrect: false },
                    { text: "æé«˜è›‹ç™½è´¨çš„å¯æº¶æ€§", isCorrect: false },
                    { text: "ä½œä¸ºæŸ“è‰²å‰‚æ˜¾ç¤ºè›‹ç™½è´¨æ¡å¸¦", isCorrect: false }
                ],
                type: questionTypes.GEL
            },
            {
                question: "ä»¥ä¸‹å“ªç§æŸ“æ–™ä¸ç”¨äºè›‹ç™½è´¨å‡èƒ¶æŸ“è‰²ï¼Ÿ",
                answers: [
                    { text: "æº´åŒ–ä¹™é”­ï¼ˆEBï¼‰", isCorrect: true },
                    { text: "è€ƒé©¬æ–¯äº®è“ï¼ˆCoomassie Blueï¼‰", isCorrect: false },
                    { text: "é“¶æŸ“ï¼ˆSilver stainï¼‰", isCorrect: false },
                    { text: "è§å…‰æŸ“æ–™ï¼ˆSYPRO Rubyï¼‰", isCorrect: false }
                ],
                type: questionTypes.GEL
            },

            // ç»†èƒåŸ¹å…»é—®é¢˜
            {
                question: "åœ¨å“ºä¹³åŠ¨ç‰©ç»†èƒåŸ¹å…»ä¸­ï¼Œèƒ°è›‹ç™½é…¶çš„ä¸»è¦ä½œç”¨æ˜¯ï¼š",
                answers: [
                    { text: "æ¶ˆåŒ–ç»†èƒå¤–åŸºè´¨è›‹ç™½ï¼Œä½¿ç»†èƒä»åŸ¹å…»çš¿ä¸Šè„±ç¦»", isCorrect: true },
                    { text: "æ€æ­»ç»†èŒï¼Œé˜²æ­¢åŸ¹å…»æ±¡æŸ“", isCorrect: false },
                    { text: "ä¿ƒè¿›ç»†èƒç”Ÿé•¿å’Œåˆ†è£‚", isCorrect: false },
                    { text: "å¢åŠ åŸ¹å…»åŸºçš„è¥å…»æˆåˆ†", isCorrect: false }
                ],
                type: questionTypes.CELL
            },
            {
                question: "ç»†èƒå†»å­˜è¿‡ç¨‹ä¸­ï¼Œå¸¸ç”¨çš„å†·å†»ä¿æŠ¤å‰‚æ˜¯ï¼š",
                answers: [
                    { text: "DMSOï¼ˆäºŒç”²åŸºäºšç œï¼‰", isCorrect: true },
                    { text: "ç”²é†›", isCorrect: false },
                    { text: "ä¹™é†‡", isCorrect: false },
                    { text: "ç”˜æ²¹", isCorrect: false }
                ],
                type: questionTypes.CELL
            },
            {
                question: "è½¬æŸ“æ˜¯æŒ‡ï¼š",
                answers: [
                    { text: "å°†å¤–æºDNA/RNAå¯¼å…¥çœŸæ ¸ç»†èƒ", isCorrect: true },
                    { text: "å°†ç—…æ¯’æ„ŸæŸ“ç»†èƒ", isCorrect: false },
                    { text: "ç»†èƒåˆ†åŒ–æˆå¦ä¸€ç§ç»†èƒç±»å‹", isCorrect: false },
                    { text: "ç»†èƒä»ä¸€ä¸ªåŸ¹å…»çš¿è½¬ç§»åˆ°å¦ä¸€ä¸ªåŸ¹å…»çš¿", isCorrect: false }
                ],
                type: questionTypes.CELL
            }
        ];


        // // é­”é­”åé¦ˆä¿¡æ¯
        // const momoFeedbacks = [
        //     { min: 0, max: 20, text: "é­”é­”éå¸¸ç”Ÿæ°”ï¼Œå¥¹è¯´å†ä¹Ÿä¸æƒ³ç†ä½ äº†ï¼", emoji: "ğŸ˜¡", phrase: momoNegativePhrases[0] },
        //     { min: 21, max: 40, text: "é­”é­”è¿˜åœ¨ç”Ÿæ°”ä¸­ï¼Œä½†å¶å°”ä¼šç¥ä½ ä¸€çœ¼...", emoji: "ğŸ˜ ", phrase: momoNegativePhrases[1] },
        //     { min: 41, max: 60, text: "é­”é­”çš„è¡¨æƒ…ç¼“å’Œäº†ä¸€äº›ï¼Œä½†è¿˜æ˜¯ä¸å¤ªé«˜å…´", emoji: "ğŸ˜’", phrase: momoNegativePhrases[2] },
        //     { min: 61, max: 80, text: "é­”é­”ä¼¼ä¹æ¶ˆæ°”äº†ä¸€ç‚¹ï¼Œå¼€å§‹æ„¿æ„å¬ä½ è¯´è¯", emoji: "ğŸ˜", phrase: momoPositivePhrases[4] },
        //     { min: 81, max: 89, text: "é­”é­”å·²ç»ä¸å†ç”Ÿæ°”ï¼Œå˜´è§’å¾®å¾®ä¸Šæ‰¬", emoji: "ğŸ˜Š", phrase: momoPositivePhrases[1] },
        //     { min: 90, max: 100, text: "é­”é­”å®Œå…¨å¼€å¿ƒäº†ï¼Œç¬‘ç€å‘ä½ é è¿‘ï¼", emoji: "ğŸ˜", phrase: momoPositivePhrases[0] }
        // ];


        // å¾—åˆ†åé¦ˆä¿¡æ¯
        const scoreFeedbacks = [
            { min: 0, max: 20, text: "å¾ˆé—æ†¾ï¼Œä½ çš„å¾—åˆ†å¾ˆä½ï¼Œéœ€è¦å¥½å¥½å¤ä¹ äº†ï¼", emoji: "ğŸ˜±", phrase: negativeFeedback[0] },
            { min: 21, max: 40, text: "å¾—åˆ†è¾ƒä½ï¼ŒåŸºç¡€çŸ¥è¯†è¿˜éœ€è¦åŠ å¼ºï¼", emoji: "ğŸ˜”", phrase: negativeFeedback[1] },
            { min: 41, max: 60, text: "åŠæ ¼äº†ï¼Œä½†è¿˜æœ‰å¾ˆå¤§æå‡ç©ºé—´ï¼", emoji: "ğŸ˜", phrase: negativeFeedback[2] },
            { min: 61, max: 80, text: "ä¸é”™çš„å¾—åˆ†ï¼Œç»§ç»­åŠªåŠ›ï¼", emoji: "ğŸ™‚", phrase: positiveFeedback[4] },
            { min: 81, max: 89, text: "å¾ˆå¥½çš„æˆç»©ï¼ŒåŸºç¡€çŸ¥è¯†æŒæ¡å¾—ä¸é”™ï¼", emoji: "ğŸ˜Š", phrase: positiveFeedback[1] },
            { min: 90, max: 100, text: "ä¼˜ç§€ï¼ä½ å¯¹è¿™äº›çŸ¥è¯†ç‚¹æŒæ¡å¾—éå¸¸å¥½ï¼", emoji: "ğŸ‰", phrase: positiveFeedback[0] }
        ];

        // DOMå…ƒç´ 
        const startScreen = document.getElementById('start-screen');
        const mainGameScreen = document.getElementById('main-game-screen');
        const resultScreen = document.getElementById('result-screen');
        const startGameBtn = document.getElementById('start-game-btn');
        const restartGameBtn = document.getElementById('restart-game-btn');
        const momoMoodBar = document.getElementById('momo-mood-bar');
        const momoMoodValue = document.getElementById('momo-mood-value');
        const momoMoodEmoji = document.getElementById('momo-mood-emoji');
        const momoLoveBar = document.getElementById('momo-love-bar');
        const momoLoveValue = document.getElementById('momo-love-value');
        const momoLoveEmoji = document.getElementById('momo-love-emoji');
        const momoQuote = document.getElementById('momo-quote');
        const optionsContainer = document.getElementById('options-container');
        const sceneDescription = document.getElementById('scene-description');
        const roundCounter = document.getElementById('round-counter');
        const timerBar = document.getElementById('timer-bar');
        const timerText = document.getElementById('timer-text');
        const eventNotification = document.getElementById('event-notification');
        const eventTitle = document.getElementById('event-title');
        const eventDesc = document.getElementById('event-desc');


        // ç»“æœç•Œé¢å…ƒç´ 
        const resultTitle = document.getElementById('result-title');
        const resultDesc = document.getElementById('result-desc');
        const resultBorder = document.getElementById('result-border');
        const finalMomoMood = document.getElementById('final-momo-mood');
        const finalMomoLove = document.getElementById('final-momo-love');
        const finalMomoEmoji = document.getElementById('final-momo-emoji');
        const finalLoveEmoji = document.getElementById('final-love-emoji');
        const totalActions = document.getElementById('total-actions');
        const randomEventsElement = document.getElementById('random-events');
        const timeoutCount = document.getElementById('timeout-count');

        // è®¡æ—¶å™¨ç›¸å…³å˜é‡
        let timerInterval;
        let timeLeft;

        // æ›´æ–°é¡µé¢UIå…ƒç´ æ–‡æœ¬
        function updateUITexts() {
            // ä¿®æ”¹é¡¶éƒ¨æ ‡é¢˜
            // document.querySelector('h1.text-xl').textContent = "å®éªŒå®¤æ¨¡æ‹Ÿå™¨ - æŒ‘æˆ˜æ¨¡å¼";
            document.querySelector('p.text-gray-500.text-sm').textContent = "åˆ†å­ç”Ÿç‰©å­¦çŸ¥è¯†é—®ç­”";

            // ä¿®æ”¹å¼€å§‹ç•Œé¢æ–‡æœ¬
            document.querySelector('#start-screen h2').textContent = "åˆ†å­ç”Ÿç‰©å­¦çŸ¥è¯†é—®ç­”";
            document.querySelector('#start-screen p.mb-3').textContent = "è­¦å‘Šï¼šä½ éœ€è¦å¿«é€Ÿå›ç­”å„ç§åˆ†å­ç”Ÿç‰©å­¦é—®é¢˜ï¼";

            // ä¿®æ”¹çŠ¶æ€æ æ ‡ç­¾
            document.querySelectorAll('.flex.justify-between.items-center.mb-1 span.text-sm.text-gray-600')[0].textContent = "å½“å‰å¾—åˆ†";
            document.querySelectorAll('.flex.justify-between.items-center.mb-1 span.text-sm.text-gray-600')[1].textContent = "æ­£ç¡®ç‡";

            // ä¿®æ”¹æ—¶é—´æ¡æ ·å¼
            const timerBarElement = document.getElementById('timer-bar');
            if (timerBarElement) {
                timerBarElement.style.transition = 'width 0.2s linear, background-color 0.5s';
                timerBarElement.classList.remove('timer-active'); // ç¡®ä¿ç§»é™¤åŠ¨ç”»ç±»
            }

            // ä¿®æ”¹æŒ‰é’®æ–‡æœ¬
            document.getElementById('start-game-btn').textContent = "å¼€å§‹æŒ‘æˆ˜";
            document.getElementById('restart-game-btn').textContent = "å†æ¬¡æŒ‘æˆ˜";

            // ä¿®æ”¹æ¸¸æˆè§„åˆ™
            const rulesItems = document.querySelectorAll('#start-screen .my-4.bg-gray-50 ul.mb-3 li');
            rulesItems[0].textContent = "â€¢ åˆå§‹åˆ†æ•°ä¸º30";
            rulesItems[1].textContent = "â€¢ èƒœåˆ©æ¡ä»¶ï¼šå¸ˆå§å¿ƒæƒ…æˆ–æ­£ç¡®ç‡éœ€è¾¾95+";
            rulesItems[2].textContent = "â€¢ å›åˆæ•°åªæœ‰10è½®";
            rulesItems[3].textContent = "â€¢ æ¯è½®éœ€å›ç­”ä¸åŒç±»å‹çš„åˆ†å­ç”Ÿç‰©å­¦é—®é¢˜";
            rulesItems[4].textContent = "â€¢ éšæœºäº‹ä»¶ä¼šçªç„¶é™ä½åˆ†æ•°";
            rulesItems[5].textContent = "â€¢ æ—¶é—´å‹åŠ›ï¼šæ¯è½®å›ç­”é™æ—¶30ç§’";
            rulesItems[6].textContent = "â€¢ å¾—åˆ†ä½äº40æ—¶ï¼Œå›ç­”æ­£ç¡®çš„åŠ åˆ†æ•ˆæœå‡åŠ";

            // ä¿®æ”¹ç»“æœç•Œé¢æ ‡ç­¾
            // Additional UI text updates
            document.querySelector('.font-bold.text-red-600.mb-1').textContent = "å¸ˆå§ï¼š";
            document.querySelectorAll('#result-screen .flex.justify-between.items-center.mb-1 span.text-sm')[0].textContent = "æœ€ç»ˆå¾—åˆ†ï¼š";
            document.querySelectorAll('#result-screen .flex.justify-between.items-center.mb-1 span.text-sm')[1].textContent = "æ­£ç¡®ç‡ï¼š";
        }

        // æ›´æ–°çŠ¶æ€æ 
        function updateStatusBars() {
            momoMoodBar.style.width = `${gameState.score}%`;
            momoMoodValue.textContent = gameState.score;

            momoLoveBar.style.width = `${gameState.correctAnswers}%`;
            momoLoveValue.textContent = gameState.correctAnswers;

            // æ ¹æ®å¾—åˆ†æ›´æ–°çŠ¶æ€æ é¢œè‰²å’Œè¡¨æƒ…
            updateBarColors();

            // æ›´æ–°å¸ˆå§çš„åé¦ˆ
            updateFeedback();
        }


        // æ›´æ–°çŠ¶æ€æ é¢œè‰²å’Œè¡¨æƒ…
        function updateBarColors() {
            // å¾—åˆ†é¢œè‰²å’Œè¡¨æƒ…
            if (gameState.score < 30) {
                momoMoodBar.className = "progress-fill bg-red-500";
                momoMoodEmoji.textContent = "ğŸ˜±";
            } else if (gameState.score < 60) {
                momoMoodBar.className = "progress-fill bg-orange-400";
                momoMoodEmoji.textContent = "ğŸ˜”";
            } else if (gameState.score < 80) {
                momoMoodBar.className = "progress-fill bg-yellow-400";
                momoMoodEmoji.textContent = "ğŸ™‚";
            } else if (gameState.score < 95) {
                momoMoodBar.className = "progress-fill bg-green-400";
                momoMoodEmoji.textContent = "ğŸ˜Š";
            } else {
                momoMoodBar.className = "progress-fill bg-green-500";
                momoMoodEmoji.textContent = "ğŸ‰";
            }

            // æ­£ç¡®ç‡é¢œè‰²å’Œè¡¨æƒ…
            if (gameState.correctAnswers < 30) {
                momoLoveBar.className = "progress-fill bg-red-500";
                momoLoveEmoji.textContent = "âŒ";
            } else if (gameState.correctAnswers < 60) {
                momoLoveBar.className = "progress-fill bg-orange-400";
                momoLoveEmoji.textContent = "âš ï¸";
            } else if (gameState.correctAnswers < 80) {
                momoLoveBar.className = "progress-fill bg-yellow-400";
                momoLoveEmoji.textContent = "âœ“";
            } else if (gameState.correctAnswers < 95) {
                momoLoveBar.className = "progress-fill bg-green-400";
                momoLoveEmoji.textContent = "âœ…";
            } else {
                momoLoveBar.className = "progress-fill bg-green-500";
                momoLoveEmoji.textContent = "ğŸ†";
            }
        }


        // æ›´æ–°å¸ˆå§çš„åé¦ˆ
        function updateFeedback() {
            // æ ¹æ®å¾—åˆ†è·å–å¯¹åº”çš„åé¦ˆ
            const feedback = scoreFeedbacks.find(f => gameState.score >= f.min && gameState.score <= f.max);

            // æ›´æ–°åœºæ™¯æè¿°
            sceneDescription.textContent = feedback.text;

            // æ›´æ–°å¸ˆå§çš„å¯¹è¯
            if (gameState.score < 40) {
                // åœ¨å¾—åˆ†ä½æ—¶ï¼Œæ˜¾ç¤ºè´Ÿé¢è¯„è¯­
                const randomIndex = Math.floor(Math.random() * negativeFeedback.length);
                momoQuote.textContent = `"${negativeFeedback[randomIndex]}"`;
            } else if (gameState.score >= 80) {
                // åœ¨å¾—åˆ†é«˜æ—¶ï¼Œæ˜¾ç¤ºæ­£é¢è¯„è¯­
                const randomIndex = Math.floor(Math.random() * positiveFeedback.length);
                momoQuote.textContent = `"${positiveFeedback[randomIndex]}"`;
            } else {
                // åœ¨ä¸­é—´çŠ¶æ€æ—¶ï¼Œæ˜¾ç¤ºåé¦ˆä¸­çš„è¯„è¯­
                momoQuote.textContent = `"${feedback.phrase}"`;
            }
        }

        // ç”Ÿæˆé—®é¢˜å’Œé€‰é¡¹
        function generateQuestion() {
            // æ¸…ç©ºé€‰é¡¹å®¹å™¨
            optionsContainer.innerHTML = '';

            // ä»é—®é¢˜æ± ä¸­éšæœºé€‰æ‹©ä¸€ä¸ªé—®é¢˜
            const randomIndex = Math.floor(Math.random() * questionPool.length);
            const selectedQuestion = questionPool[randomIndex];
            gameState.currentQuestion = selectedQuestion;

            // è®¾ç½®é—®é¢˜æè¿°
            sceneDescription.textContent = selectedQuestion.question;

            // æ‰“ä¹±é€‰é¡¹é¡ºåº
            const shuffledAnswers = [...selectedQuestion.answers];
            shuffleArray(shuffledAnswers);

            // åˆ›å»ºé€‰é¡¹æŒ‰é’®
            shuffledAnswers.forEach(answer => {
                const button = document.createElement('button');
                button.className = 'option-btn w-full p-3 mb-2 text-left border border-gray-200 rounded hover:bg-blue-50 transition';
                button.textContent = answer.text;

                // æ·»åŠ é€‰é¡¹äº‹ä»¶
                button.addEventListener('click', () => {
                    handleAnswerSelect(answer);
                });

                optionsContainer.appendChild(button);
            });

            // æ›´æ–°å¸ˆå§å¯¹è¯ä¸ºé—®é¢˜æç¤º
            momoQuote.textContent = `"${selectedQuestion.question}"`;
        }


        // å¤„ç†ç­”æ¡ˆé€‰æ‹©
        function handleAnswerSelect(answer) {
            // åœæ­¢è®¡æ—¶å™¨
            clearInterval(timerInterval);
            timerBar.classList.remove('timer-active');

            // åœ¨è¿™é‡Œæ·»åŠ è®¾ç½®æ—¶é—´æ¡å®½åº¦çš„ä»£ç 
            timerBar.style.width = `${(timeLeft / gameState.timerDuration) * 100}%`;

            // è®¡ç®—å¾—åˆ†å˜åŒ–
            let scoreEffect = 0;
            let correctEffect = 0;

            if (answer.isCorrect) {
                // ç­”å¯¹äº†ï¼Œå¢åŠ å¾—åˆ†å’Œæ­£ç¡®ç‡
                scoreEffect = 10;
                correctEffect = 15;

                // æ›´æ–°å¸ˆå§å¯¹è¯ä¸ºæ­£é¢è¯„ä»·
                const randomIndex = Math.floor(Math.random() * positiveFeedback.length);
                momoQuote.textContent = `"${positiveFeedback[randomIndex]}"`;
            } else {
                // ç­”é”™äº†ï¼Œå‡å°‘å¾—åˆ†å’Œæ­£ç¡®ç‡
                scoreEffect = -15;
                correctEffect = -10;

                // æ›´æ–°å¸ˆå§å¯¹è¯ä¸ºè´Ÿé¢è¯„ä»·
                const randomIndex = Math.floor(Math.random() * negativeFeedback.length);
                momoQuote.textContent = `"${negativeFeedback[randomIndex]}"`;
            }

            // å¦‚æœå¾—åˆ†ä½äº40ï¼Œæ•ˆæœå‡åŠ
            if (gameState.score < 40) {
                scoreEffect = Math.floor(scoreEffect / 2);
                correctEffect = Math.floor(correctEffect / 2);
            }

            // æ›´æ–°æ¸¸æˆçŠ¶æ€
            gameState.score = Math.max(0, Math.min(100, gameState.score + scoreEffect));
            gameState.correctAnswers = Math.max(0, Math.min(100, gameState.correctAnswers + correctEffect));
            gameState.lastQuestionType = gameState.currentQuestion.type;
            // To ensure consistency with any remaining old code:
            gameState.lastOptionType = gameState.currentQuestion.type;
            // æ›´æ–°çŠ¶æ€æ 
            updateStatusBars();

            // ç»§ç»­æ¸¸æˆ
            continueGame();
        }

       

        // ç»§ç»­æ¸¸æˆ
        function continueGame() {
            // å¢åŠ å›åˆæ•°
            gameState.round++;

            // æ›´æ–°å›åˆæ˜¾ç¤º
            roundCounter.textContent = `ç¬¬${gameState.round}/${gameState.maxRounds}è½®`;

            // æ£€æŸ¥æ¸¸æˆæ˜¯å¦ç»“æŸ
            if (gameState.round >= gameState.maxRounds) {
                endGame();
                return;
            }

            // å¯èƒ½è§¦å‘éšæœºäº‹ä»¶
            if (Math.random() < 0.3) { // 30%å‡ ç‡è§¦å‘éšæœºäº‹ä»¶
                triggerRandomEvent();
            } else {
                // ç”Ÿæˆæ–°çš„é—®é¢˜å’Œé€‰é¡¹
                generateQuestion();

                // å¼€å§‹æ–°ä¸€è½®è®¡æ—¶
                startTimer();
            }
        }


        // è§¦å‘éšæœºäº‹ä»¶
        function triggerRandomEvent() {
            // é€‰æ‹©ä¸€ä¸ªéšæœºäº‹ä»¶
            const randomEvent = randomEventsData[Math.floor(Math.random() * randomEventsData.length)];

            // æ›´æ–°äº‹ä»¶è®¡æ•°
            gameState.eventCount++;

            // æš‚åœè®¡æ—¶å™¨æœŸé—´ï¼Œä¿æŒæ—¶é—´æ¡çŠ¶æ€
            timerBar.style.width = `${(timeLeft / gameState.timerDuration) * 100}%`;

            // æ˜¾ç¤ºäº‹ä»¶é€šçŸ¥
            eventTitle.textContent = randomEvent.title;
            eventDesc.textContent = randomEvent.desc;
            eventNotification.classList.remove('hidden');
            eventNotification.classList.add('event-notification');

            // åº”ç”¨äº‹ä»¶æ•ˆæœ
            gameState.score = Math.max(0, gameState.score + randomEvent.scoreEffect);
            gameState.correctAnswers = Math.max(0, gameState.correctAnswers + randomEvent.correctEffect);

            // æ›´æ–°çŠ¶æ€æ 
            updateStatusBars();

            // 3ç§’åéšè—é€šçŸ¥å¹¶ç»§ç»­æ¸¸æˆ
            setTimeout(() => {
                eventNotification.classList.add('hidden');
                eventNotification.classList.remove('event-notification');

                // ç”Ÿæˆæ–°çš„é—®é¢˜å’Œé€‰é¡¹
                generateQuestion();

                // å¼€å§‹æ–°ä¸€è½®è®¡æ—¶
                startTimer();
            }, 3000);
        }


        // ç”Ÿæˆæ–°çš„éœ€æ±‚
        function generateNewNeed() {
            // è·å–æ‰€æœ‰éœ€æ±‚ç±»å‹
            const needTypes = Object.values(optionTypes);

            // éšæœºé€‰æ‹©ä¸€ä¸ªéœ€æ±‚ï¼ˆé¿å…é‡å¤ï¼‰
            let newNeed;
            do {
                newNeed = needTypes[Math.floor(Math.random() * needTypes.length)];
            } while (newNeed === gameState.currentNeed);

            gameState.currentNeed = newNeed;

            // æ›´æ–°éœ€æ±‚æ˜¾ç¤º
            // currentNeedElement.textContent = needDescriptions[newNeed];
        }
        // åœ¨startTimerå‡½æ•°ä¸­ä¿®æ”¹æ—¶é—´æ¡å®ç°æ–¹å¼
        function startTimer() {
            // é‡ç½®è®¡æ—¶å™¨
            timeLeft = gameState.timerDuration;
            timerText.textContent = `å‰©ä½™æ—¶é—´: ${timeLeft}ç§’`;

            // ç§»é™¤CSSåŠ¨ç”»ç±»ï¼Œæ”¹ç”¨JavaScriptæ§åˆ¶å®½åº¦
            timerBar.classList.remove('timer-active');
            // é‡ç½®æ—¶é—´æ¡å®½åº¦ä¸º100%
            timerBar.style.width = '100%';
            timerBar.style.backgroundColor = '#60a5fa'; // è“è‰²å¼€å§‹

            // æ¸…é™¤ä¹‹å‰çš„è®¡æ—¶å™¨
            if (timerInterval) {
                clearInterval(timerInterval);
            }

            // å¯åŠ¨è®¡æ—¶å™¨
            timerInterval = setInterval(() => {
                timeLeft--;
                timerText.textContent = `å‰©ä½™æ—¶é—´: ${timeLeft}ç§’`;

                // æ›´æ–°æ—¶é—´æ¡å®½åº¦
                const percentage = (timeLeft / gameState.timerDuration) * 100;
                timerBar.style.width = `${percentage}%`;

                // æ›´æ–°æ—¶é—´æ¡é¢œè‰²
                if (percentage <= 50) {
                    timerBar.style.backgroundColor = '#f59e0b'; // é»„è‰²
                }
                if (percentage <= 25) {
                    timerBar.style.backgroundColor = '#ef4444'; // çº¢è‰²
                }

                if (timeLeft <= 0) {
                    // è®¡æ—¶ç»“æŸ
                    clearInterval(timerInterval);
                    handleTimeout();
                }
            }, 1000);
        }

        // å¤„ç†è¶…æ—¶
        function handleTimeout() {
            // å¢åŠ è¶…æ—¶è®¡æ•°
            gameState.timeoutCount++;

            // è®¾ç½®æ—¶é—´æ¡å®½åº¦ä¸º0
            timerBar.style.width = '0%';

            // å› ä¸ºè¶…æ—¶æ²¡æœ‰å›ç­”ï¼Œé™ä½å¾—åˆ†å’Œæ­£ç¡®ç‡
            gameState.score = Math.max(0, gameState.score - 10);
            gameState.correctAnswers = Math.max(0, gameState.correctAnswers - 8);

            // æ›´æ–°çŠ¶æ€æ 
            updateStatusBars();

            // ç»§ç»­æ¸¸æˆ
            continueGame();
        }
        
        // ç»“æŸæ¸¸æˆ
        function endGame() {
            // åœæ­¢è®¡æ—¶å™¨
            if (timerInterval) {
                clearInterval(timerInterval);
            }

            // éšè—æ¸¸æˆä¸»ç•Œé¢ï¼Œæ˜¾ç¤ºç»“æœç•Œé¢
            mainGameScreen.classList.add('hidden');
            resultScreen.classList.remove('hidden');

            // è®¾ç½®æœ€ç»ˆæŒ‡æ ‡
            finalMomoMood.textContent = gameState.score;
            finalMomoLove.textContent = gameState.correctAnswers;

            // è®¾ç½®æœ€ç»ˆè¡¨æƒ…
            updateFinalEmojis();

            // è®¾ç½®æ¸¸æˆæ•°æ®
            totalActions.textContent = gameState.round;
            randomEventsElement.textContent = gameState.eventCount;
            timeoutCount.textContent = gameState.timeoutCount;

            // åˆ¤æ–­æ¸¸æˆç»“æœ - ä¿®æ”¹èƒœåˆ©æ¡ä»¶é€»è¾‘
            const highScore = gameState.score >= 95;          // é«˜åˆ† - è·å¾—å¸ˆå§é’ç
            const highCorrect = gameState.correctAnswers >= 95; // é«˜æ­£ç¡®ç‡ - å®éªŒæŠ€æœ¯ç²¾é€š

            // è®¾ç½®ç»“æœæè¿°
            if (highScore && highCorrect) {
                // åŒé«˜ - å®Œç¾ç»“å±€
                resultTitle.textContent = "å®Œç¾é€šå…³ï¼";
                resultDesc.textContent = "æ­å–œä½ ï¼ä¸ä»…ç²¾é€šäº†å®éªŒæŠ€æœ¯ï¼Œä¹Ÿè·å¾—äº†å¸ˆå§çš„é’çã€‚ä½ æ˜¯å®éªŒå®¤é‡Œçš„ä¼ å¥‡ï¼";
                resultBorder.className = "border-l-4 border-green-500 pl-3 mb-6";
                document.getElementById('momo-final-quote').textContent = `"å¤ªå‰å®³äº†ï¼ä½ çš„çŸ¥è¯†æ°´å¹³éå¸¸æ‰å®ï¼Œå‰é€”æ— é‡ï¼Œä»¥åå¤šæŒ‡æ•™æˆ‘å“¦ï¼"`;
            } else if (highScore && !highCorrect) {
                // é«˜åˆ†ä½æ­£ç¡®ç‡ - è·å¾—å¸ˆå§é’çä½†æŠ€æœ¯ä¸€èˆ¬
                resultTitle.textContent = "æ„Ÿæƒ…èƒœåˆ©ï¼";
                resultDesc.textContent = "è™½ç„¶ä½ çš„å®éªŒæŠ€æœ¯è¿˜æœ‰å¾…æé«˜ï¼Œä½†ä½ èµ¢å¾—äº†å¸ˆå§çš„å¥½æ„Ÿã€‚æœ‰æ—¶å€™ï¼Œäººé™…å…³ç³»æ¯”æŠ€æœ¯æ›´é‡è¦ï¼";
                resultBorder.className = "border-l-4 border-pink-500 pl-3 mb-6";
                document.getElementById('momo-final-quote').textContent = `"è™½ç„¶ä½ çš„å®éªŒåšå¾—ä¸€èˆ¬ï¼Œä½†æ˜¯æˆ‘å¾ˆå–œæ¬¢ä½ çš„æ€åº¦å’Œçƒ­æƒ…ï¼æˆ‘å¯ä»¥æ•™ä½ æ›´å¤šçŸ¥è¯†~"`;
            } else if (!highScore && highCorrect) {
                // ä½åˆ†é«˜æ­£ç¡®ç‡ - æŠ€æœ¯ç²¾æ¹›ä½†æ²¡è·å¾—å¸ˆå§é’ç
                resultTitle.textContent = "æŠ€æœ¯èƒœåˆ©ï¼";
                resultDesc.textContent = "ä½ çš„å®éªŒæŠ€æœ¯éå¸¸å‡ºè‰²ï¼Œä½†ä¼¼ä¹å¿½ç•¥äº†ä¸å¸ˆå§çš„æ²Ÿé€šã€‚è®°ä½ï¼Œå®éªŒå®¤é‡Œä¸åªæœ‰å®éªŒï¼";
                resultBorder.className = "border-l-4 border-blue-500 pl-3 mb-6";
                document.getElementById('momo-final-quote').textContent = `"ä½ çš„å®éªŒæŠ€æœ¯ç¡®å®å¾ˆå¼ºï¼Œä½†ä½ æ€»æ˜¯é‚£ä¹ˆå†·æ·¡...å¤šå’Œå¸ˆå§äº¤æµä¸€ä¸‹å˜›ï¼"`;
            } else if (gameState.score >= 60 || gameState.correctAnswers >= 60) {
                // ä¸€èˆ¬è¡¨ç° - åŠæ ¼ä½†ä¸å‡ºè‰²
                resultTitle.textContent = "åŸºæœ¬é€šå…³";
                resultDesc.textContent = "ä½ çš„è¡¨ç°è¿˜ç®—åŠæ ¼ï¼Œä½†æ— è®ºæ˜¯å®éªŒæŠ€æœ¯è¿˜æ˜¯ä¸å¸ˆå§çš„å…³ç³»ï¼Œéƒ½è¿˜æœ‰å¾ˆå¤§æå‡ç©ºé—´ã€‚";
                resultBorder.className = "border-l-4 border-yellow-500 pl-3 mb-6";
                document.getElementById('momo-final-quote').textContent = `"è¿˜ä¸é”™ï¼Œä½†éœ€è¦æ›´åŠ åŠªåŠ›ï¼Œæ— è®ºæ˜¯å®éªŒè¿˜æ˜¯...å…¶ä»–æ–¹é¢ã€‚"`;
            } else {
                // åŒä½ - å¤±è´¥
                resultTitle.textContent = "æŒ‘æˆ˜å¤±è´¥";
                resultDesc.textContent = "æ— è®ºæ˜¯å®éªŒæŠ€æœ¯è¿˜æ˜¯ä¸å¸ˆå§çš„äº¤æµï¼Œä½ éƒ½è¡¨ç°æ¬ ä½³ã€‚å»ºè®®é‡æ–°è°ƒæ•´ç­–ç•¥ï¼Œå†æ¥ä¸€æ¬¡ï¼";
                resultBorder.className = "border-l-4 border-red-500 pl-3 mb-6";
                document.getElementById('momo-final-quote').textContent = `"å”‰ï¼Œçœ‹æ¥ä½ è¿˜éœ€è¦å¤šå¤šç»ƒä¹ ï¼Œå®éªŒæŠ€æœ¯å’Œç¤¾äº¤æŠ€å·§éƒ½æ˜¯..."`;
            }
        }
        // æ›´æ–°æœ€ç»ˆç»“æœè¡¨æƒ…
        function updateFinalEmojis() {
            // å¾—åˆ†è¡¨æƒ…
            if (gameState.score < 30) {
                finalMomoEmoji.textContent = "ğŸ˜±";
            } else if (gameState.score < 60) {
                finalMomoEmoji.textContent = "ğŸ˜”";
            } else if (gameState.score < 80) {
                finalMomoEmoji.textContent = "ğŸ™‚";
            } else if (gameState.score < 95) {
                finalMomoEmoji.textContent = "ğŸ˜Š";
            } else {
                finalMomoEmoji.textContent = "ğŸ‰";
            }

            // æ­£ç¡®ç‡è¡¨æƒ…
            if (gameState.correctAnswers < 30) {
                finalLoveEmoji.textContent = "âŒ";
            } else if (gameState.correctAnswers < 60) {
                finalLoveEmoji.textContent = "âš ï¸";
            } else if (gameState.correctAnswers < 80) {
                finalLoveEmoji.textContent = "âœ“";
            } else if (gameState.correctAnswers < 95) {
                finalLoveEmoji.textContent = "âœ…";
            } else {
                finalLoveEmoji.textContent = "ğŸ†";
            }
        }

        // è¾…åŠ©å‡½æ•°ï¼šéšæœºæ‰“ä¹±æ•°ç»„
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // åˆå§‹åŒ–æ¸¸æˆ
        function initGame() {
            console.log('Game initialization started');

            // é‡ç½®æ¸¸æˆçŠ¶æ€
            gameState.score = 30;
            gameState.correctAnswers = 30;
            // gameState.kokoMood = 30;
            gameState.gameOver = false;
            gameState.round = 0;
            gameState.timeoutCount = 0;
            gameState.eventCount = 0;
            gameState.lastOptionType = null;
            gameState.lastQuestionType = null;  // ADD THIS LINE
            gameState.currentQuestion = null;   // ADD THIS LINE
            gameState.repeatedOptions = {};

            // æ˜¾ç¤ºæ¸¸æˆç•Œé¢ï¼Œéšè—ç»“æœç•Œé¢
            startScreen.classList.add('hidden');
            mainGameScreen.classList.remove('hidden');
            resultScreen.classList.add('hidden');

            // æ›´æ–°çŠ¶æ€æ 
            updateStatusBars();

            // // ç”Ÿæˆåˆå§‹éœ€æ±‚
            // generateNewNeed();

            // // ç”Ÿæˆåˆå§‹é€‰é¡¹
            // generateOptions();
            // To this:
            generateQuestion();

            // å¼€å§‹è®¡æ—¶
            startTimer();
        }

        // é¡µé¢åŠ è½½å®Œæˆåï¼Œæ˜¾ç¤ºå¼€å§‹ç•Œé¢å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬
        document.addEventListener('DOMContentLoaded', () => {
            // æ˜¾ç¤ºæ­£ç¡®çš„åˆå§‹ç•Œé¢
            startScreen.classList.remove('hidden');
            mainGameScreen.classList.add('hidden');
            resultScreen.classList.add('hidden');

            // æ›´æ–°UIæ–‡æœ¬ - ADD THIS LINE
            updateUITexts();

            // ç¡®ä¿æŒ‰é’®å­˜åœ¨åå†æ·»åŠ äº‹ä»¶ç›‘å¬
            if (startGameBtn) {
                startGameBtn.addEventListener('click', initGame);
                console.log('Start game button event listener added');
            } else {
                console.error('Start game button not found');
            }

            if (restartGameBtn) {
                restartGameBtn.addEventListener('click', initGame);
                console.log('Restart game button event listener added');
            } else {
                console.error('Restart game button not found');
            }

            // è°ƒè¯•æ—¥å¿—
            console.log('Game initialized and ready to start');
            // åœ¨document.addEventListener('DOMContentLoaded', () => { å‡½æ•°ä¸­æ·»åŠ ä»¥ä¸‹ä»£ç 
            // ä¿®æ”¹æ—¶é—´æ¡çš„CSSæ ·å¼
            const timerBarElement = document.getElementById('timer-bar');
            if (timerBarElement) {
                // ç§»é™¤åŸæœ‰çš„åŠ¨ç”»ç›¸å…³CSS
                timerBarElement.style.animationName = 'none';
                timerBarElement.style.animationPlayState = 'none';

                // ç¡®ä¿å®½åº¦å¯ä»¥é€šè¿‡JSæ§åˆ¶
                timerBarElement.style.width = '100%';
                timerBarElement.style.transition = 'width 0.2s linear, background-color 0.5s';
            }
        });
    </script>
