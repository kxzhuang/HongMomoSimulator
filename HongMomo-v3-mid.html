<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å©å©æ¨¡æ‹Ÿå™¨ - å“„é­”é­”å¼€å¿ƒï¼ˆå›°éš¾æ¨¡å¼ï¼‰</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            background-color: #f5f5f5;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
        }
        .option-btn:hover {
            background-color: #f0f7ff;
        }
        .progress-bar {
            height: 12px;
            border-radius: 6px;
            background-color: #e2e8f0;
            overflow: hidden;
        }
        .progress-fill {
            height: 100%;
            border-radius: 6px;
            transition: width 0.5s ease-out;
        }
        @keyframes timerAnimation {
            from { width: 100%; background-color: #60a5fa; }
            50% { background-color: #f59e0b; }
            to { width: 0%; background-color: #ef4444; }
        }
        .timer-bar {
            height: 6px;
            border-radius: 3px;
            background-color: #60a5fa;
            width: 100%;
            animation-name: timerAnimation;
            animation-timing-function: linear;
            animation-play-state: paused;
        }
        .timer-active {
            animation-play-state: running;
        }
        .event-notification {
            animation: fadeInOut 4s ease-in-out;
            opacity: 0;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 50;
        }
        @keyframes fadeInOut {
            0% { opacity: 0; }
            10% { opacity: 1; }
            80% { opacity: 1; }
            100% { opacity: 0; }
        }
    </style>
</head>
<body class="bg-gray-100">
    <div class="max-w-md mx-auto bg-white shadow-sm min-h-screen relative">
        <!-- é¡¶éƒ¨æ ‡é¢˜ -->
        <div class="text-center py-4 border-b border-gray-200">
            <h1 class="text-xl font-bold text-red-800">å©å©æ¨¡æ‹Ÿå™¨ - ä¸­çº§æ¨¡å¼</h1>
            <p class="text-gray-500 text-sm">å“„é­”é­”å¼€å¿ƒï¼ˆé­”ç‹çº§ï¼‰</p>
        </div>
        
        <!-- éšæœºäº‹ä»¶é€šçŸ¥ -->
        <div id="event-notification" class="event-notification hidden">
            <div class="bg-red-100 border-l-4 border-red-600 text-red-700 p-4 rounded shadow-lg">
                <p class="font-bold mb-1" id="event-title">çªå‘äº‹ä»¶</p>
                <p id="event-desc">é­”é­”çªç„¶æƒ³èµ·äº†ä½ ä¸Šä¸ªæœˆå¿˜è®°å¥¹ç”Ÿæ—¥çš„äº‹æƒ…ï¼</p>
            </div>
        </div>
        
        <!-- æ¸¸æˆç•Œé¢å®¹å™¨ -->
        <div id="game-container">
            <!-- å¼€å§‹æ¸¸æˆç•Œé¢ -->
            <div id="start-screen" class="p-4">
                <h2 class="text-lg font-bold mb-4 text-red-800">å©å©æ¨¡æ‹Ÿå™¨ï¼šå“„é­”é­”å¼€å¿ƒï¼ˆä¸­çº§æ¨¡å¼ï¼‰</h2>
                
                <p class="mb-3">2025å¹´3æœˆ7æ—¥ï¼Œä½œä¸ºé­”é­”çš„ç”·æœ‹å‹å©å©ï¼Œä½ è¯´äº†ä¸€äº›æ·±æ·±ä¼¤å®³é­”é­”çš„è¯ï¼Œå¯¼è‡´å¥¹éå¸¸ç”Ÿæ°”ã€‚</p>
                <p class="mb-3">è¿™æ¬¡å’Œå¥½å¯¹ä½ ä»¬çš„å…³ç³»è‡³å…³é‡è¦ï¼Œç„¶è€Œé­”é­”æƒ…ç»ªå·²ç»é™åˆ°å†å²æœ€ä½ç‚¹ã€‚</p>
                <p class="mb-3 font-bold text-red-700">è­¦å‘Šï¼šä¸­çº§æ¨¡å¼ä¸‹ï¼Œé­”é­”çš„å¿ƒæƒ…æŒç»­ä¸‹é™ï¼Œä½ å¿…é¡»æ›´åŠ è¿…é€Ÿä¸”é«˜æ•ˆåœ°å®‰æŠšå¥¹ï¼</p>
                
                <div class="my-4 bg-gray-50 p-3 rounded">
                    <h3 class="font-bold mb-2">æ¸¸æˆè§„åˆ™å˜æ›´ï¼š</h3>
                    <ul class="mb-3 pl-4 space-y-1 text-sm">
                        <li>â€¢ åˆå§‹æ•°å€¼æ›´ä½ï¼ˆ30ï¼‰</li>
                        <li>â€¢ èƒœåˆ©æ¡ä»¶æ›´é«˜ï¼ˆå¿ƒæƒ…å’Œå–œæ¬¢åº¦éœ€è¾¾95+ï¼‰</li>
                        <li>â€¢ å›åˆæ•°å‡å°‘ï¼ˆåªæœ‰10è½®ï¼‰</li>
                        <li>â€¢ é­”é­”å¿ƒæƒ…æ¯è½®è‡ªåŠ¨è¡°å‡</li>
                        <li>â€¢ éšæœºäº‹ä»¶ä¼šçªç„¶é™ä½è¿›åº¦</li>
                        <li>â€¢ åŒç±»é€‰é¡¹é‡å¤ä½¿ç”¨æ•ˆæœå¤§å¹…ä¸‹é™</li>
                        <li>â€¢ æ—¶é—´å‹åŠ›ï¼šæ¯è½®é€‰æ‹©é™æ—¶30ç§’</li>
                        <li>â€¢ å¿ƒæƒ…ä½äº40æ—¶ï¼Œæ‰€æœ‰é€‰é¡¹æ•ˆæœå‡åŠ</li>
                    </ul>
                </div>
                
                <button id="start-game-btn" class="w-full py-2 bg-red-100 text-red-800 border border-red-200 rounded text-center">
                    å¼€å§‹æŒ‘æˆ˜
                </button>
            </div>
            
            <!-- ä¸»æ¸¸æˆç•Œé¢ -->
            <div id="main-game-screen" class="hidden">
                <!-- æƒ…æ™¯æè¿° -->
                <div class="p-4">
                    <p id="scene-description" class="text-gray-700">
                        ä½ ååœ¨é­”é­”çš„æˆ¿é—´é‡Œï¼Œå¥¹éå¸¸ç”Ÿæ°”åœ°çœ‹ç€ä½ ã€‚ä½ ä¹‹å‰è¯´çš„è¯æ·±æ·±ä¼¤å®³äº†å¥¹ï¼Œç°åœ¨éœ€è¦è¿…é€Ÿè§£å†³è¿™ä¸ªå±æœºã€‚
                    </p>
                    
                    <div class="my-4 pl-3 border-l-4 border-red-500">
                        <p class="font-bold text-red-600 mb-1">é­”é­”ï¼š</p>
                        <p id="momo-quote" class="text-gray-800">"ä¸æƒ³ç†ä½ äº†ï¼ä½ æ ¹æœ¬ä¸åœ¨ä¹æˆ‘çš„æ„Ÿå—ï¼"</p>
                    </div>
                    
                    <div id="momo-needs" class="my-3 px-3 py-2 bg-red-50 text-sm text-red-700 rounded">
                        <p class="font-medium">é­”é­”çš„å½“å‰éœ€æ±‚ï¼š<span id="current-need">æœªçŸ¥</span></p>
                    </div>
                </div>
                
                <!-- çŠ¶æ€æŒ‡æ ‡ -->
                <div class="px-4 py-3 bg-gray-50">
                    <!-- é­”é­”å¿ƒæƒ…å€¼ -->
                    <div class="flex justify-between items-center mb-1">
                        <span class="text-sm text-gray-600">é­”é­”å¿ƒæƒ…å€¼</span>
                        <div class="flex items-center">
                            <span id="momo-mood-emoji" class="mr-1">ğŸ˜ </span>
                            <span id="momo-mood-value" class="text-sm font-medium">30</span>
                        </div>
                    </div>
                    <div class="progress-bar mb-3">
                        <div id="momo-mood-bar" class="progress-fill bg-red-500" style="width: 30%"></div>
                    </div>
                    
                    <!-- é­”é­”å–œæ¬¢å©å©å€¼ -->
                    <div class="flex justify-between items-center mb-1">
                        <span class="text-sm text-gray-600">é­”é­”å–œæ¬¢å©å©å€¼</span>
                        <div class="flex items-center">
                            <span id="momo-love-emoji" class="mr-1">ğŸ’”</span>
                            <span id="momo-love-value" class="text-sm font-medium">30</span>
                        </div>
                    </div>
                    <div class="progress-bar mb-3">
                        <div id="momo-love-bar" class="progress-fill bg-red-500" style="width: 30%"></div>
                    </div>
                    
                    <!-- å©å©å¿ƒæƒ…å€¼ -->
                    <div class="flex justify-between items-center mb-1">
                        <span class="text-sm text-gray-600">å©å©å¿ƒæƒ…å€¼</span>
                        <div class="flex items-center">
                            <span id="koko-mood-emoji" class="mr-1">ğŸ˜°</span>
                            <span id="koko-mood-value" class="text-sm font-medium">30</span>
                        </div>
                    </div>
                    <div class="progress-bar">
                        <div id="koko-mood-bar" class="progress-fill bg-red-500" style="width: 30%"></div>
                    </div>
                </div>
                
                <!-- å›åˆå’Œå€’è®¡æ—¶ -->
                <div class="p-4 pt-2 pb-0 flex justify-between items-center">
                    <span class="text-sm font-medium" id="round-counter">ç¬¬1/10è½®</span>
                    <span class="text-sm font-medium" id="timer-text">å‰©ä½™æ—¶é—´: 30ç§’</span>
                </div>
                <div class="px-4 pt-1 pb-1">
                    <div class="timer-bar" id="timer-bar"></div>
                </div>
                
                <!-- é€‰é¡¹åŒºåŸŸ -->
                <div id="options-container" class="p-4">
                    <!-- é€‰é¡¹å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                </div>
            </div>
            
            <!-- ç»“æœç•Œé¢ -->
            <div id="result-screen" class="hidden p-4">
                <div class="border-l-4 pl-3 mb-6" id="result-border">
                    <h2 id="result-title" class="text-lg font-bold mb-2">æ¸¸æˆç»“æŸ</h2>
                    
                    <p id="result-desc" class="mb-4">
                        ç»“æœæè¿°...
                    </p>
                    
                    <div class="mb-4">
                        <p class="font-medium mb-1">æœ€ç»ˆæŒ‡æ ‡ï¼š</p>
                        <div class="flex justify-between items-center mb-1">
                            <span class="text-sm">é­”é­”å¿ƒæƒ…å€¼ï¼š</span>
                            <div class="flex items-center">
                                <span id="final-momo-emoji" class="mr-1">ğŸ˜Š</span>
                                <span id="final-momo-mood" class="font-medium">85</span>
                            </div>
                        </div>
                        <div class="flex justify-between items-center mb-1">
                            <span class="text-sm">é­”é­”å–œæ¬¢å©å©å€¼ï¼š</span>
                            <div class="flex items-center">
                                <span id="final-love-emoji" class="mr-1">â¤ï¸</span>
                                <span id="final-momo-love" class="font-medium">80</span>
                            </div>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-sm">å©å©å¿ƒæƒ…å€¼ï¼š</span>
                            <div class="flex items-center">
                                <span id="final-koko-emoji" class="mr-1">ğŸ˜Œ</span>
                                <span id="final-koko-mood" class="font-medium">60</span>
                            </div>
                        </div>
                    </div>
                    
                    <p id="momo-final-quote" class="italic text-gray-700 mb-3">"é­”é­”çš„æœ€ç»ˆè¯„ä»·..."</p>
                    
                    <div class="bg-gray-50 p-3 rounded mb-4 text-sm">
                        <p class="font-medium mb-1">æ¸¸æˆæ•°æ®ï¼š</p>
                        <div class="flex justify-between mb-1">
                            <span>æ€»å…±é€‰æ‹©çš„è¡ŒåŠ¨ï¼š</span>
                            <span id="total-actions">8</span>
                        </div>
                        <div class="flex justify-between mb-1">
                            <span>è§¦å‘çš„éšæœºäº‹ä»¶ï¼š</span>
                            <span id="random-events">2</span>
                        </div>
                        <div class="flex justify-between">
                            <span>é€‰é¡¹è¶…æ—¶æ¬¡æ•°ï¼š</span>
                            <span id="timeout-count">1</span>
                        </div>
                    </div>
                </div>
                
                <button id="restart-game-btn" class="w-full py-2 bg-red-100 text-red-800 border border-red-200 rounded text-center">
                    é‡æ–°æŒ‘æˆ˜
                </button>
            </div>
        </div>
    </div>
    
    <script>
        // æ¸¸æˆçŠ¶æ€
const gameState = {
    momoMood: 30,           // é­”é­”å¿ƒæƒ…å€¼
    momoLove: 30,           // é­”é­”å–œæ¬¢å©å©å€¼
    kokoMood: 30,           // å©å©å¿ƒæƒ…å€¼
    gameOver: false,        // æ¸¸æˆæ˜¯å¦ç»“æŸ
    round: 0,               // å½“å‰è½®æ•°
    maxRounds: 10,           // æœ€å¤§è½®æ•°
    timeoutCount: 0,        // è¶…æ—¶æ¬¡æ•°
    eventCount: 0,          // éšæœºäº‹ä»¶è§¦å‘æ¬¡æ•°
    lastOptionType: null,   // ä¸Šä¸€æ¬¡é€‰æ‹©çš„é€‰é¡¹ç±»å‹
    repeatedOptions: {},    // è®°å½•é‡å¤ä½¿ç”¨çš„é€‰é¡¹ç±»å‹
    currentNeed: null,      // é­”é­”å½“å‰çš„éœ€æ±‚ç±»å‹
    timerDuration: 30       // è®¡æ—¶å™¨æŒç»­æ—¶é—´ï¼ˆç§’ï¼‰
};

// é€‰é¡¹ç±»å‹
const optionTypes = {
    APOLOGY: "é“æ­‰",
    GIFT: "ç¤¼ç‰©",
    PHYSICAL: "è‚¢ä½“æ¥è§¦",
    QUALITY_TIME: "é™ªä¼´",
    PROMISE: "æ‰¿è¯º",
    DISTRACTION: "è½¬ç§»æ³¨æ„åŠ›",
    SELF_EXPLANATION: "è§£é‡Šè‡ªå·±"
};

// éœ€æ±‚ç±»å‹æè¿°
const needDescriptions = {
    [optionTypes.APOLOGY]: "é­”é­”å¸Œæœ›å¬åˆ°çœŸè¯šçš„é“æ­‰",
    [optionTypes.GIFT]: "é­”é­”æƒ³è¦æ”¶åˆ°ç¤¼ç‰©å’ŒæƒŠå–œ",
    [optionTypes.PHYSICAL]: "é­”é­”éœ€è¦è‚¢ä½“æ¥è§¦çš„å®‰æ…°",
    [optionTypes.QUALITY_TIME]: "é­”é­”éœ€è¦é«˜è´¨é‡çš„é™ªä¼´æ—¶é—´",
    [optionTypes.PROMISE]: "é­”é­”éœ€è¦çœ‹åˆ°å…·ä½“çš„æ”¹å˜æ‰¿è¯º",
    [optionTypes.DISTRACTION]: "é­”é­”éœ€è¦ä¸€äº›å¿«ä¹çš„è½¬ç§»æ³¨æ„åŠ›",
    [optionTypes.SELF_EXPLANATION]: "é­”é­”æƒ³å¬ä½ è§£é‡Šå·¥ä½œçš„è¾›è‹¦"
};

// é­”é­”çš„è´Ÿé¢å’Œæ­£é¢è¯è¯­
const momoNegativePhrases = [
    "ä¸ç†ä½ äº†ï¼å‹¾çŸ³ï¼",
    "ä½ æ ¹æœ¬ä¸æ‡‚æˆ‘ï¼",
    "æˆ‘å¾ˆç”Ÿæ°”ï¼",
    "ä½ æ€»æ˜¯è¿™æ ·ï¼",
    "æˆ‘æ¨æ­»ä½ äº†ï¼",
    "ä½ æ ¹æœ¬ä¸åœ¨ä¹æˆ‘ï¼",
    "æˆ‘æ„Ÿè§‰ä½ ä¸€ç‚¹éƒ½ä¸çˆ±æˆ‘...",
    "ä½ å°±çŸ¥é“å·¥ä½œï¼Œéƒ½ä¸é™ªæˆ‘ï¼"
];

const momoPositivePhrases = [
    "æ£’æ£’ï¼",
    "çœŸå¯çˆ±~",
    "èµçŒ«ï¼",
    "å©å©æœ€å¥½äº†ï¼",
    "å‹‰å¼ºåŸè°…ä½ ä¸€ä¸‹ä¸‹~",
    "å—¯...ä½ è¿˜ç®—æœ‰ç‚¹è‰¯å¿ƒ",
    "å¥½å•¦å¥½å•¦ï¼Œä¸ç”Ÿæ°”äº†~",
    "å©å©ï¼Œçˆ±ä½ å“¦~"
];

// éšæœºäº‹ä»¶
const randomEventsData = [
    {
        title: "å›å¿†æ¶Œç°",
        desc: "é­”é­”çªç„¶æƒ³èµ·äº†ä½ ä¸Šä¸ªæœˆå¿˜è®°å¥¹ç”Ÿæ—¥çš„äº‹æƒ…ï¼",
        moodEffect: -15,
        loveEffect: -10
    },
    {
        title: "å¥½å‹å½±å“",
        desc: "é­”é­”çš„é—ºèœœå‘æ¥æ¶ˆæ¯ï¼Œè¯´ä½ è‚¯å®šæ˜¯æ•·è¡å¥¹ï¼",
        moodEffect: -10,
        loveEffect: -15
    },
    {
        title: "æƒ…ç»ªçˆ†å‘",
        desc: "é­”é­”çªç„¶æƒ…ç»ªå´©æºƒï¼Œå¼€å§‹æ— å£°è½æ³ª...",
        moodEffect: -20,
        loveEffect: -5
    },
    {
        title: "è¿‡å¾€ä¼¤ç—›",
        desc: "é­”é­”æƒ³èµ·äº†ä½ ä»¬ä¹‹å‰çš„äº‰åµï¼Œæƒ…ç»ªæ€¥å‰§æ¶åŒ–ï¼",
        moodEffect: -15,
        loveEffect: -15
    },
    {
        title: "æ¶ˆææ€è€ƒ",
        desc: "é­”é­”æ€€ç–‘ä½ æ˜¯ä¸æ˜¯ä¸å†çˆ±å¥¹äº†...",
        moodEffect: -5,
        loveEffect: -20
    }
];

// é€‰é¡¹æ± 
const optionPool = [
    // é“æ­‰ç±»é€‰é¡¹
    { 
        text: "å¯¹ä¸èµ·ï¼Œé­”é­”ï¼Œæˆ‘ä¸åº”è¯¥è¯´é‚£äº›è¯ä¼¤å®³ä½ çš„æ„Ÿå—ã€‚", 
        mood: 12, 
        love: 10, 
        self: -5,
        type: optionTypes.APOLOGY 
    },
    { 
        text: "é­”é­”ï¼Œæˆ‘çœŸçš„å¾ˆæŠ±æ­‰ï¼Œæˆ‘è¯´è¯ä¸ç»æ€è€ƒï¼Œä¼¤å®³äº†ä½ ã€‚", 
        mood: 15, 
        love: 12, 
        self: -8,
        type: optionTypes.APOLOGY 
    },
    { 
        text: "æˆ‘é”™äº†ï¼Œé‚£äº›è¯æˆ‘ä¸è¯¥è¯´ï¼Œä¼¤å®³äº†ä½ æˆ‘å¾ˆåæ‚”ã€‚", 
        mood: 10, 
        love: 8, 
        self: -10,
        type: optionTypes.APOLOGY 
    },
    
    // ç¤¼ç‰©ç±»é€‰é¡¹
    { 
        text: "æˆ‘ç»™ä½ ä¹°äº†ä½ æœ€å–œæ¬¢çš„å¥¶èŒ¶ï¼ŒåŠ äº†ä¸¤ä»½çç ã€‚", 
        mood: 8, 
        love: 12, 
        self: -8,
        type: optionTypes.GIFT 
    },
    { 
        text: "çœ‹ï¼Œæˆ‘å·å·ç»™ä½ å‡†å¤‡äº†è¿™ä¸ªå°ç¤¼ç‰©ï¼Œå¸Œæœ›ä½ ä¼šå–œæ¬¢ã€‚", 
        mood: 10, 
        love: 15, 
        self: -10,
        type: optionTypes.GIFT 
    },
    { 
        text: "ç»™é­”é­”ä¹°äº†ä½ æœ€çˆ±åƒçš„è‚‰è‚‰ï¼Œç°åœ¨å°±å»åšç»™ä½ åƒï¼", 
        mood: 12, 
        love: 18, 
        self: -8,
        type: optionTypes.GIFT 
    },
    
    // è‚¢ä½“æ¥è§¦ç±»é€‰é¡¹
    { 
        text: "è¿‡æ¥ï¼Œäº²äº²é­”é­”~", 
        mood: 15, 
        love: 18, 
        self: -5,
        type: optionTypes.PHYSICAL 
    },
    { 
        text: "è¦ä¸è¦æŠ±æŠ±ï¼Ÿæˆ‘çŸ¥é“æŠ±æŠ±å¯ä»¥è®©ä½ èˆ’æœä¸€ç‚¹ã€‚", 
        mood: 12, 
        love: 15, 
        self: -3,
        type: optionTypes.PHYSICAL 
    },
    { 
        text: "æ¥ï¼Œä¸¾é«˜é«˜ï¼", 
        mood: 18, 
        love: 15, 
        self: -8,
        type: optionTypes.PHYSICAL 
    },
    
    // é«˜è´¨é‡é™ªä¼´é€‰é¡¹
    { 
        text: "æˆ‘ä»¬ä¸€èµ·å»åƒä½ æœ€å–œæ¬¢çš„é‚£å®¶ç«é”…å§ï¼Ÿæˆ‘çŸ¥é“ä½ æƒ³å»å¾ˆä¹…äº†ã€‚", 
        mood: 10, 
        love: 12, 
        self: -3,
        type: optionTypes.QUALITY_TIME 
    },
    { 
        text: "è¦ä¸æˆ‘ä»¬ä¸€èµ·å‡ºå»æ•£æ•£æ­¥ï¼Ÿæ•£æ­¥æ—¶æˆ‘å¯ä»¥å¬ä½ è¯´è¯´å¿ƒé‡Œçš„æƒ³æ³•ã€‚", 
        mood: 12, 
        love: 15, 
        self: 0,
        type: optionTypes.QUALITY_TIME 
    },
    { 
        text: "é­”é­”ï¼Œæˆ‘ä»¬ä¸€èµ·çœ‹ä¸ªç”µå½±æ”¾æ¾ä¸€ä¸‹å§ã€‚ä½ æŒ‘ä½ å–œæ¬¢çš„ï¼", 
        mood: 8, 
        love: 10, 
        self: 0,
        type: optionTypes.QUALITY_TIME 
    },
    
    // æ‰¿è¯ºç±»é€‰é¡¹
    { 
        text: "æˆ‘ä»¥åä¼šæ›´æ³¨æ„è‡ªå·±çš„è¨€è¡Œï¼Œä¸ä¼šå†è¿™æ ·ä¼¤å®³ä½ äº†ã€‚", 
        mood: 8, 
        love: 12, 
        self: -5,
        type: optionTypes.PROMISE 
    },
    { 
        text: "æˆ‘ä¿è¯ä»¥åä¼šå¤šèŠ±æ—¶é—´é™ªä½ ï¼ŒæŠŠä½ æ”¾åœ¨ç¬¬ä¸€ä½ã€‚", 
        mood: 12, 
        love: 15, 
        self: -8,
        type: optionTypes.PROMISE 
    },
    { 
        text: "æˆ‘ä¼šæ”¹å˜ï¼ŒçœŸçš„ã€‚ä»ä»Šå¤©å¼€å§‹ï¼Œæˆ‘ä¼šæ›´å…³å¿ƒä½ çš„æ„Ÿå—ã€‚", 
        mood: 10, 
        love: 12, 
        self: -5,
        type: optionTypes.PROMISE 
    },
    
    // è½¬ç§»æ³¨æ„åŠ›é€‰é¡¹
    { 
        text: "ç»™ä½ çœ‹æˆ‘çè—çš„æç¬‘è§†é¢‘ï¼Œä¿è¯è®©ä½ ç¬‘ã€‚", 
        mood: 8, 
        love: 5, 
        self: 3,
        type: optionTypes.DISTRACTION 
    },
    { 
        text: "æˆ‘ç»™ä½ è·³ä¸ªèˆå§ï¼æˆ‘å·å·ç»ƒäº†å¥½ä¹…ï¼Œå°±ç­‰ç€ç»™ä½ çœ‹å‘¢ã€‚", 
        mood: 15, 
        love: 18, 
        self: -8,
        type: optionTypes.DISTRACTION 
    },
    { 
        text: "é­”é­”ï¼Œè®©æˆ‘ç»™ä½ æŒ æŒ ç—’ç—’å§ï¼ŒçŸ¥é“ä½ æœ€å–œæ¬¢è¿™ä¸ªäº†ã€‚", 
        mood: 18, 
        love: 20, 
        self: -5,
        type: optionTypes.DISTRACTION 
    },
    
    // è§£é‡Šå·¥ä½œå¿™çš„é€‰é¡¹
    { 
        text: "å¯¹ä¸èµ·é­”é­”ï¼Œæˆ‘è¿™å‡ å¤©workå¤ªå¿™äº†ï¼Œæ²¡æœ‰ç…§é¡¾å¥½ä½ çš„æ„Ÿå—ã€‚", 
        mood: 15, 
        love: 18, 
        self: -5,
        type: optionTypes.SELF_EXPLANATION 
    },
    { 
        text: "æˆ‘è¿™æ®µæ—¶é—´workå¤ªå¿™äº†ï¼Œä¸åº”è¯¥æŠŠæƒ…ç»ªå¸¦ç»™ä½ ï¼Œæˆ‘å¾ˆæŠ±æ­‰ã€‚", 
        mood: 12, 
        love: 15, 
        self: -8,
        type: optionTypes.SELF_EXPLANATION 
    },
    { 
        text: "æˆ‘çŸ¥é“æˆ‘æœ€è¿‘å¤ªå¿™äº†ï¼Œæ²¡æœ‰é™ªä½ ï¼Œè®©ä½ æ„Ÿåˆ°è¢«å¿½è§†äº†ï¼Œå¯¹ä¸èµ·ã€‚", 
        mood: 15, 
        love: 20, 
        self: -5,
        type: optionTypes.SELF_EXPLANATION 
    },
    
    // è´Ÿé¢é€‰é¡¹
    { 
        text: "ä½ å…ˆå†·é™ä¸€ä¸‹ï¼Œç­‰ä½ æ°”æ¶ˆäº†æˆ‘ä»¬å†è°ˆå§ã€‚", 
        mood: -15, 
        love: -20, 
        self: 5,
        type: optionTypes.APOLOGY 
    },
    { 
        text: "æˆ‘ä¸€å®šæ˜¯å¤ªç´¯äº†æ‰ä¼šé‚£æ ·è¯´è¯ï¼ŒåŸè°…æˆ‘å¥½å—ï¼Ÿ", 
        mood: -5, 
        love: -5, 
        self: 10,
        type: optionTypes.SELF_EXPLANATION 
    },
    { 
        text: "è¦ä¸æˆ‘ä»¬è¿˜æ˜¯ä¿æŒç‚¹è·ç¦»å†·é™ä¸€ä¸‹å§ã€‚", 
        mood: -20, 
        love: -15, 
        self: 8,
        type: optionTypes.QUALITY_TIME 
    }
];

// é­”é­”åé¦ˆä¿¡æ¯
const momoFeedbacks = [
    { min: 0, max: 20, text: "é­”é­”éå¸¸ç”Ÿæ°”ï¼Œå¥¹è¯´å†ä¹Ÿä¸æƒ³ç†ä½ äº†ï¼", emoji: "ğŸ˜¡", phrase: momoNegativePhrases[0] },
    { min: 21, max: 40, text: "é­”é­”è¿˜åœ¨ç”Ÿæ°”ä¸­ï¼Œä½†å¶å°”ä¼šç¥ä½ ä¸€çœ¼...", emoji: "ğŸ˜ ", phrase: momoNegativePhrases[1] },
    { min: 41, max: 60, text: "é­”é­”çš„è¡¨æƒ…ç¼“å’Œäº†ä¸€äº›ï¼Œä½†è¿˜æ˜¯ä¸å¤ªé«˜å…´", emoji: "ğŸ˜’", phrase: momoNegativePhrases[2] },
    { min: 61, max: 80, text: "é­”é­”ä¼¼ä¹æ¶ˆæ°”äº†ä¸€ç‚¹ï¼Œå¼€å§‹æ„¿æ„å¬ä½ è¯´è¯", emoji: "ğŸ˜", phrase: momoPositivePhrases[4] },
    { min: 81, max: 89, text: "é­”é­”å·²ç»ä¸å†ç”Ÿæ°”ï¼Œå˜´è§’å¾®å¾®ä¸Šæ‰¬", emoji: "ğŸ˜Š", phrase: momoPositivePhrases[1] },
    { min: 90, max: 100, text: "é­”é­”å®Œå…¨å¼€å¿ƒäº†ï¼Œç¬‘ç€å‘ä½ é è¿‘ï¼", emoji: "ğŸ˜", phrase: momoPositivePhrases[0] }
];

// DOMå…ƒç´ 
const startScreen = document.getElementById('start-screen');
const mainGameScreen = document.getElementById('main-game-screen');
const resultScreen = document.getElementById('result-screen');
const startGameBtn = document.getElementById('start-game-btn');
const restartGameBtn = document.getElementById('restart-game-btn');
const momoMoodBar = document.getElementById('momo-mood-bar');
const momoMoodValue = document.getElementById('momo-mood-value');
const momoMoodEmoji = document.getElementById('momo-mood-emoji');
const momoLoveBar = document.getElementById('momo-love-bar');
const momoLoveValue = document.getElementById('momo-love-value');
const momoLoveEmoji = document.getElementById('momo-love-emoji');
const kokoMoodBar = document.getElementById('koko-mood-bar');
const kokoMoodValue = document.getElementById('koko-mood-value');
const kokoMoodEmoji = document.getElementById('koko-mood-emoji');
const momoQuote = document.getElementById('momo-quote');
const optionsContainer = document.getElementById('options-container');
const sceneDescription = document.getElementById('scene-description');
const roundCounter = document.getElementById('round-counter');
const timerBar = document.getElementById('timer-bar');
const timerText = document.getElementById('timer-text');
const currentNeedElement = document.getElementById('current-need');
const eventNotification = document.getElementById('event-notification');
const eventTitle = document.getElementById('event-title');
const eventDesc = document.getElementById('event-desc');

// ç»“æœç•Œé¢å…ƒç´ 
const resultTitle = document.getElementById('result-title');
const resultDesc = document.getElementById('result-desc');
const resultBorder = document.getElementById('result-border');
const finalMomoMood = document.getElementById('final-momo-mood');
const finalMomoLove = document.getElementById('final-momo-love');
const finalKokoMood = document.getElementById('final-koko-mood');
const finalMomoEmoji = document.getElementById('final-momo-emoji');
const finalLoveEmoji = document.getElementById('final-love-emoji');
const finalKokoEmoji = document.getElementById('final-koko-emoji');
const totalActions = document.getElementById('total-actions');
const randomEventsElement = document.getElementById('random-events'); // ä¿®å¤äº†å˜é‡åå†²çª
const timeoutCount = document.getElementById('timeout-count');

// è®¡æ—¶å™¨ç›¸å…³å˜é‡
let timerInterval;
let timeLeft;

// æ›´æ–°çŠ¶æ€æ 
function updateStatusBars() {
    momoMoodBar.style.width = `${gameState.momoMood}%`;
    momoMoodValue.textContent = gameState.momoMood;
    
    momoLoveBar.style.width = `${gameState.momoLove}%`;
    momoLoveValue.textContent = gameState.momoLove;
    
    kokoMoodBar.style.width = `${gameState.kokoMood}%`;
    kokoMoodValue.textContent = gameState.kokoMood;
    
    // æ ¹æ®å¿ƒæƒ…å€¼æ›´æ–°çŠ¶æ€æ é¢œè‰²å’Œè¡¨æƒ…
    updateBarColors();
    
    // æ›´æ–°é­”é­”çš„åé¦ˆ
    updateMomoFeedback();
}

// æ›´æ–°çŠ¶æ€æ é¢œè‰²å’Œè¡¨æƒ…
function updateBarColors() {
    // é­”é­”å¿ƒæƒ…å€¼é¢œè‰²å’Œè¡¨æƒ…
    if (gameState.momoMood < 30) {
        momoMoodBar.className = "progress-fill bg-red-500";
        momoMoodEmoji.textContent = "ğŸ˜¡";
    } else if (gameState.momoMood < 60) {
        momoMoodBar.className = "progress-fill bg-orange-400";
        momoMoodEmoji.textContent = "ğŸ˜ ";
    } else if (gameState.momoMood < 80) {
        momoMoodBar.className = "progress-fill bg-yellow-400";
        momoMoodEmoji.textContent = "ğŸ˜";
    } else if (gameState.momoMood < 95) {
        momoMoodBar.className = "progress-fill bg-green-400";
        momoMoodEmoji.textContent = "ğŸ˜Š";
    } else {
        momoMoodBar.className = "progress-fill bg-green-500";
        momoMoodEmoji.textContent = "ğŸ˜";
    }
    
    // é­”é­”å–œæ¬¢å©å©å€¼é¢œè‰²å’Œè¡¨æƒ…
    if (gameState.momoLove < 30) {
        momoLoveBar.className = "progress-fill bg-red-500";
        momoLoveEmoji.textContent = "ğŸ’”";
    } else if (gameState.momoLove < 60) {
        momoLoveBar.className = "progress-fill bg-orange-400";
        momoLoveEmoji.textContent = "â¤ï¸â€ğŸ©¹";
    } else if (gameState.momoLove < 80) {
        momoLoveBar.className = "progress-fill bg-yellow-400";
        momoLoveEmoji.textContent = "ğŸ’“";
    } else if (gameState.momoLove < 95) {
        momoLoveBar.className = "progress-fill bg-green-400";
        momoLoveEmoji.textContent = "â¤ï¸";
    } else {
        momoLoveBar.className = "progress-fill bg-green-500";
        momoLoveEmoji.textContent = "ğŸ’–";
    }
    
    // å©å©å¿ƒæƒ…å€¼é¢œè‰²å’Œè¡¨æƒ…
    if (gameState.kokoMood < 30) {
        kokoMoodBar.className = "progress-fill bg-red-500";
        kokoMoodEmoji.textContent = "ğŸ˜°";
    } else if (gameState.kokoMood < 60) {
        kokoMoodBar.className = "progress-fill bg-orange-400";
        kokoMoodEmoji.textContent = "ğŸ˜“";
    } else if (gameState.kokoMood < 80) {
        kokoMoodBar.className = "progress-fill bg-yellow-400";
        kokoMoodEmoji.textContent = "ğŸ˜…";
    } else {
        kokoMoodBar.className = "progress-fill bg-green-400";
        kokoMoodEmoji.textContent = "ğŸ˜Œ";
    }
}

// æ›´æ–°é­”é­”çš„åé¦ˆ
function updateMomoFeedback() {
    // æ ¹æ®é­”é­”å¿ƒæƒ…å€¼è·å–å¯¹åº”çš„åé¦ˆ
    const feedback = momoFeedbacks.find(f => gameState.momoMood >= f.min && gameState.momoMood <= f.max);
    
    // æ›´æ–°åœºæ™¯æè¿°
    sceneDescription.textContent = feedback.text;
    
    // æ›´æ–°é­”é­”çš„å¯¹è¯
    if (gameState.momoMood < 40) {
        // åœ¨å¿ƒæƒ…ä½æ—¶ï¼Œæ˜¾ç¤ºè´Ÿé¢å¯¹è¯
        const randomIndex = Math.floor(Math.random() * momoNegativePhrases.length);
        momoQuote.textContent = `"${momoNegativePhrases[randomIndex]}"`;
    } else if (gameState.momoMood >= 80) {
        // åœ¨å¿ƒæƒ…é«˜æ—¶ï¼Œæ˜¾ç¤ºæ­£é¢å¯¹è¯
        const randomIndex = Math.floor(Math.random() * momoPositivePhrases.length);
        momoQuote.textContent = `"${momoPositivePhrases[randomIndex]}"`;
    } else {
        // åœ¨ä¸­é—´çŠ¶æ€æ—¶ï¼Œæ˜¾ç¤ºåé¦ˆä¸­çš„å¯¹è¯
        momoQuote.textContent = `"${feedback.phrase}"`;
    }
}

// ç”Ÿæˆéšæœºé€‰é¡¹
function generateOptions() {
    // æ¸…ç©ºé€‰é¡¹å®¹å™¨
    optionsContainer.innerHTML = '';
    
    // é€‰æ‹©4ä¸ªä¸åŒçš„é€‰é¡¹
    const selectedOptions = [];
    const optionCount = 4;
    
    // å§‹ç»ˆåŒ…å«ä¸€ä¸ªç¬¦åˆå½“å‰éœ€æ±‚çš„é€‰é¡¹
    const needOptions = optionPool.filter(option => option.type === gameState.currentNeed && option.mood > 0);
    if (needOptions.length > 0) {
        const randomNeedOption = needOptions[Math.floor(Math.random() * needOptions.length)];
        selectedOptions.push(randomNeedOption);
    }
    
    // å¡«å……å‰©ä½™é€‰é¡¹
    while (selectedOptions.length < optionCount) {
        const randomIndex = Math.floor(Math.random() * optionPool.length);
        const option = optionPool[randomIndex];
        
        // ç¡®ä¿æ²¡æœ‰é‡å¤é€‰é¡¹
        if (!selectedOptions.some(selected => selected.text === option.text)) {
            selectedOptions.push(option);
        }
    }
    
    // æ‰“ä¹±é€‰é¡¹é¡ºåº
    shuffleArray(selectedOptions);
    
    // åˆ›å»ºé€‰é¡¹æŒ‰é’®
    selectedOptions.forEach(option => {
        const button = document.createElement('button');
        button.className = 'option-btn w-full p-3 mb-2 text-left border border-gray-200 rounded hover:bg-blue-50 transition';
        button.textContent = option.text;
        
        // æ·»åŠ é€‰é¡¹äº‹ä»¶
        button.addEventListener('click', () => {
            handleOptionSelect(option);
        });
        
        optionsContainer.appendChild(button);
    });
}

// å¤„ç†é€‰é¡¹é€‰æ‹©
function handleOptionSelect(option) {
    // åœæ­¢è®¡æ—¶å™¨
    clearInterval(timerInterval);
    timerBar.classList.remove('timer-active');
    
    // è®¡ç®—é€‰é¡¹æ•ˆæœ
    let moodEffect = option.mood;
    let loveEffect = option.love;
    
    // æ£€æŸ¥æ˜¯å¦ä¸å½“å‰éœ€æ±‚åŒ¹é…
    const isMatchingNeed = option.type === gameState.currentNeed;
    
    // å¦‚æœåŒ¹é…éœ€æ±‚ï¼Œæ•ˆæœæå‡
    if (isMatchingNeed) {
        moodEffect = Math.floor(moodEffect * 1.5);
        loveEffect = Math.floor(loveEffect * 1.3);
    }
    
    // æ£€æŸ¥æ˜¯å¦é‡å¤ä½¿ç”¨åŒç±»å‹é€‰é¡¹
    if (gameState.lastOptionType === option.type) {
        // è®°å½•é‡å¤æ¬¡æ•°
        gameState.repeatedOptions[option.type] = (gameState.repeatedOptions[option.type] || 0) + 1;
        
        // æ ¹æ®é‡å¤æ¬¡æ•°é™ä½æ•ˆæœ
        const repeatFactor = Math.max(0.3, 1 - (gameState.repeatedOptions[option.type] * 0.3));
        moodEffect = Math.floor(moodEffect * repeatFactor);
        loveEffect = Math.floor(loveEffect * repeatFactor);
    } else {
        // é‡ç½®è¯¥ç±»å‹çš„é‡å¤è®¡æ•°
        gameState.repeatedOptions[option.type] = 0;
    }
    
    // å¦‚æœé­”é­”å¿ƒæƒ…ä½äº40ï¼Œæ•ˆæœå‡åŠ
    if (gameState.momoMood < 40) {
        moodEffect = Math.floor(moodEffect / 2);
        loveEffect = Math.floor(loveEffect / 2);
    }
    
    // æ›´æ–°æ¸¸æˆçŠ¶æ€
    gameState.momoMood = Math.max(0, Math.min(100, gameState.momoMood + moodEffect));
    gameState.momoLove = Math.max(0, Math.min(100, gameState.momoLove + loveEffect));
    gameState.kokoMood = Math.max(0, Math.min(100, gameState.kokoMood + option.self));
    gameState.lastOptionType = option.type;
    
    // æ›´æ–°çŠ¶æ€æ 
    updateStatusBars();
    
    // ç»§ç»­æ¸¸æˆ
    continueGame();
}

// ç»§ç»­æ¸¸æˆ
function continueGame() {
    // å¢åŠ å›åˆæ•°
    gameState.round++;
    
    // æ›´æ–°å›åˆæ˜¾ç¤º
    roundCounter.textContent = `ç¬¬${gameState.round}/${gameState.maxRounds}è½®`;
    
    // æ£€æŸ¥æ¸¸æˆæ˜¯å¦ç»“æŸ
    if (gameState.round >= gameState.maxRounds) {
        endGame();
        return;
    }
    
    // éšæœºé™ä½é­”é­”çš„å¿ƒæƒ…ï¼ˆå›°éš¾æ¨¡å¼ç‰¹æ€§ï¼‰
    const moodDecay = Math.floor(Math.random() * 5) + 3; // 3-7ç‚¹è¡°å‡
    gameState.momoMood = Math.max(0, gameState.momoMood - moodDecay);
    
    // æ›´æ–°çŠ¶æ€æ 
    updateStatusBars();
    
    // å¯èƒ½è§¦å‘éšæœºäº‹ä»¶
    if (Math.random() < 0.3) { // 30%å‡ ç‡è§¦å‘éšæœºäº‹ä»¶
        triggerRandomEvent();
    } else {
        // ç”Ÿæˆæ–°çš„éœ€æ±‚å’Œé€‰é¡¹
        generateNewNeed();
        generateOptions();
        
        // å¼€å§‹æ–°ä¸€è½®è®¡æ—¶
        startTimer();
    }
}

// è§¦å‘éšæœºäº‹ä»¶
function triggerRandomEvent() {
    // é€‰æ‹©ä¸€ä¸ªéšæœºäº‹ä»¶
    const randomEvent = randomEventsData[Math.floor(Math.random() * randomEventsData.length)];
    
    // æ›´æ–°äº‹ä»¶è®¡æ•°
    gameState.eventCount++;
    
    // æ˜¾ç¤ºäº‹ä»¶é€šçŸ¥
    eventTitle.textContent = randomEvent.title;
    eventDesc.textContent = randomEvent.desc;
    eventNotification.classList.remove('hidden');
    eventNotification.classList.add('event-notification');
    
    // åº”ç”¨äº‹ä»¶æ•ˆæœ
    gameState.momoMood = Math.max(0, gameState.momoMood + randomEvent.moodEffect);
    gameState.momoLove = Math.max(0, gameState.momoLove + randomEvent.loveEffect);
    
    // æ›´æ–°çŠ¶æ€æ 
    updateStatusBars();
    
    // 3ç§’åéšè—é€šçŸ¥å¹¶ç»§ç»­æ¸¸æˆ
    setTimeout(() => {
        eventNotification.classList.add('hidden');
        eventNotification.classList.remove('event-notification');
        
        // ç”Ÿæˆæ–°çš„éœ€æ±‚å’Œé€‰é¡¹
        generateNewNeed();
        generateOptions();
        
        // å¼€å§‹æ–°ä¸€è½®è®¡æ—¶
        startTimer();
    }, 3000);
}

// ç”Ÿæˆæ–°çš„éœ€æ±‚
function generateNewNeed() {
    // è·å–æ‰€æœ‰éœ€æ±‚ç±»å‹
    const needTypes = Object.values(optionTypes);
    
    // éšæœºé€‰æ‹©ä¸€ä¸ªéœ€æ±‚ï¼ˆé¿å…é‡å¤ï¼‰
    let newNeed;
    do {
        newNeed = needTypes[Math.floor(Math.random() * needTypes.length)];
    } while (newNeed === gameState.currentNeed);
    
    gameState.currentNeed = newNeed;
    
    // æ›´æ–°éœ€æ±‚æ˜¾ç¤º
    currentNeedElement.textContent = needDescriptions[newNeed];
}

// å¼€å§‹è®¡æ—¶å™¨
function startTimer() {
    // é‡ç½®è®¡æ—¶å™¨
    timeLeft = gameState.timerDuration;
    timerText.textContent = `å‰©ä½™æ—¶é—´: ${timeLeft}ç§’`;
    
    // é‡ç½®è®¡æ—¶å™¨æ ·å¼
    timerBar.style.animationDuration = `${gameState.timerDuration}s`;
    timerBar.classList.add('timer-active');
    
    // æ¸…é™¤ä¹‹å‰çš„è®¡æ—¶å™¨
    if (timerInterval) {
        clearInterval(timerInterval);
    }
    
    // å¯åŠ¨è®¡æ—¶å™¨
    timerInterval = setInterval(() => {
        timeLeft--;
        timerText.textContent = `å‰©ä½™æ—¶é—´: ${timeLeft}ç§’`;
        
        if (timeLeft <= 0) {
            // è®¡æ—¶ç»“æŸ
            clearInterval(timerInterval);
            handleTimeout();
        }
    }, 1000);
}

// å¤„ç†è¶…æ—¶
function handleTimeout() {
    // å¢åŠ è¶…æ—¶è®¡æ•°
    gameState.timeoutCount++;
    
    // å› ä¸ºè¶…æ—¶æ²¡æœ‰åšå‡ºé€‰æ‹©ï¼Œé™ä½é­”é­”å¿ƒæƒ…å’Œå¥½æ„Ÿ
    gameState.momoMood = Math.max(0, gameState.momoMood - 10);
    gameState.momoLove = Math.max(0, gameState.momoLove - 8);
    gameState.kokoMood = Math.max(0, gameState.kokoMood - 5);
    
    // æ›´æ–°çŠ¶æ€æ 
    updateStatusBars();
    
    // ç»§ç»­æ¸¸æˆ
    continueGame();
}

// ç»“æŸæ¸¸æˆ
function endGame() {
    // åœæ­¢è®¡æ—¶å™¨
    if (timerInterval) {
        clearInterval(timerInterval);
    }
    
    // éšè—æ¸¸æˆä¸»ç•Œé¢ï¼Œæ˜¾ç¤ºç»“æœç•Œé¢
    mainGameScreen.classList.add('hidden');
    resultScreen.classList.remove('hidden');
    
    // è®¾ç½®æœ€ç»ˆæŒ‡æ ‡
    finalMomoMood.textContent = gameState.momoMood;
    finalMomoLove.textContent = gameState.momoLove;
    finalKokoMood.textContent = gameState.kokoMood;
    
    // è®¾ç½®æœ€ç»ˆè¡¨æƒ…
    updateFinalEmojis();
    
    // è®¾ç½®æ¸¸æˆæ•°æ®
    totalActions.textContent = gameState.round;
    randomEventsElement.textContent = gameState.eventCount;
    timeoutCount.textContent = gameState.timeoutCount;
    
    // åˆ¤æ–­æ¸¸æˆç»“æœ
    const victory = gameState.momoMood >= 95 && gameState.momoLove >= 95;
    const goodEnding = gameState.momoMood >= 80 && gameState.momoLove >= 80;
    const neutralEnding = gameState.momoMood >= 60 && gameState.momoLove >= 60;
    
    // è®¾ç½®ç»“æœæè¿°
    if (victory) {
        resultTitle.textContent = "å®Œç¾èƒœåˆ©ï¼";
        resultDesc.textContent = "æ­å–œä½ æˆåŠŸå“„å¥½äº†é­”é­”ï¼å¥¹ç°åœ¨éå¸¸å¼€å¿ƒï¼Œå¯¹ä½ çš„å–œçˆ±è¾¾åˆ°äº†æ–°é«˜åº¦ï¼ä½ æ˜¯å“„å¥³å‹ä¸“å®¶ï¼";
        resultBorder.className = "border-l-4 border-green-500 pl-3 mb-6";
        document.getElementById('momo-final-quote').textContent = `"å©å©æœ€æ£’äº†ï¼ä½ æ€»æ˜¯çŸ¥é“æ€ä¹ˆè®©æˆ‘å¼€å¿ƒï¼çˆ±ä½ å“¦ï½"`;
    } else if (goodEnding) {
        resultTitle.textContent = "å’Œå¥½æˆåŠŸï¼";
        resultDesc.textContent = "ä½ æˆåŠŸåŒ–è§£äº†è¿™åœºå±æœºï¼Œé­”é­”å·²ç»ä¸å†ç”Ÿæ°”ã€‚å¥¹ä¼¼ä¹å¾ˆæ»¡æ„ä½ çš„è¡¨ç°ï¼";
        resultBorder.className = "border-l-4 border-blue-500 pl-3 mb-6";
        document.getElementById('momo-final-quote').textContent = `"è¿˜ç®—æœ‰ç‚¹è‰¯å¿ƒï½çŸ¥é“æ€ä¹ˆå“„æˆ‘å¼€å¿ƒï¼"`;
    } else if (neutralEnding) {
        resultTitle.textContent = "å‹‰å¼ºå’Œå¥½";
        resultDesc.textContent = "é­”é­”çš„æƒ…ç»ªæœ‰æ‰€ç¼“å’Œï¼Œä½†å¥¹è¿˜æ˜¯æœ‰äº›ä¸æ»¡ã€‚ä½ éœ€è¦ç»§ç»­åŠªåŠ›ä¿®å¤è¿™æ®µå…³ç³»ã€‚";
        resultBorder.className = "border-l-4 border-yellow-500 pl-3 mb-6";
        document.getElementById('momo-final-quote').textContent = `"å¥½å§ï¼Œæˆ‘åŸè°…ä½ è¿™ä¸€æ¬¡ã€‚ä¸è¿‡ä¸‹æ¬¡ä¸è®¸è¿™æ ·äº†ï¼"`;
    } else {
        resultTitle.textContent = "å¤±è´¥å‘Šç»ˆ";
        resultDesc.textContent = "é­”é­”è¿˜æ˜¯å¾ˆç”Ÿæ°”ï¼Œå¥¹è¯´éœ€è¦å†·é™ä¸€ä¸‹ã€‚è¿™æ¬¡çš„å±æœºå¤„ç†å¹¶ä¸æˆåŠŸï¼Œä½ éœ€è¦åæ€è‡ªå·±çš„æ²Ÿé€šæ–¹å¼ã€‚";
        resultBorder.className = "border-l-4 border-red-500 pl-3 mb-6";
        document.getElementById('momo-final-quote').textContent = `"ä¸æƒ³ç†ä½ äº†ï¼æˆ‘éœ€è¦è‡ªå·±å†·é™ä¸€ä¸‹..."`;
    }
}

// æ›´æ–°æœ€ç»ˆç»“æœè¡¨æƒ…
function updateFinalEmojis() {
    // é­”é­”å¿ƒæƒ…è¡¨æƒ…
    if (gameState.momoMood < 30) {
        finalMomoEmoji.textContent = "ğŸ˜¡";
    } else if (gameState.momoMood < 60) {
        finalMomoEmoji.textContent = "ğŸ˜ ";
    } else if (gameState.momoMood < 80) {
        finalMomoEmoji.textContent = "ğŸ˜";
    } else if (gameState.momoMood < 95) {
        finalMomoEmoji.textContent = "ğŸ˜Š";
    } else {
        finalMomoEmoji.textContent = "ğŸ˜";
    }
    
    // é­”é­”å–œæ¬¢å©å©è¡¨æƒ…
    if (gameState.momoLove < 30) {
        finalLoveEmoji.textContent = "ğŸ’”";
    } else if (gameState.momoLove < 60) {
        finalLoveEmoji.textContent = "â¤ï¸â€ğŸ©¹";
    } else if (gameState.momoLove < 80) {
        finalLoveEmoji.textContent = "ğŸ’“";
    } else if (gameState.momoLove < 95) {
        finalLoveEmoji.textContent = "â¤ï¸";
    } else {
        finalLoveEmoji.textContent = "ğŸ’–";
    }
    
    // å©å©å¿ƒæƒ…è¡¨æƒ…
    if (gameState.kokoMood < 30) {
        finalKokoEmoji.textContent = "ğŸ˜°";
    } else if (gameState.kokoMood < 60) {
        finalKokoEmoji.textContent = "ğŸ˜“";
    } else if (gameState.kokoMood < 80) {
        finalKokoEmoji.textContent = "ğŸ˜…";
    } else {
        finalKokoEmoji.textContent = "ğŸ˜Œ";
    }
}

// è¾…åŠ©å‡½æ•°ï¼šéšæœºæ‰“ä¹±æ•°ç»„
function shuffleArray(array) {
    for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
    }
    return array;
}

// åˆå§‹åŒ–æ¸¸æˆ
function initGame() {
    console.log('Game initialization started');
    
    // é‡ç½®æ¸¸æˆçŠ¶æ€
    gameState.momoMood = 30;
    gameState.momoLove = 30;
    gameState.kokoMood = 30;
    gameState.gameOver = false;
    gameState.round = 0;
    gameState.timeoutCount = 0;
    gameState.eventCount = 0;
    gameState.lastOptionType = null;
    gameState.repeatedOptions = {};
    
    // æ˜¾ç¤ºæ¸¸æˆç•Œé¢ï¼Œéšè—ç»“æœç•Œé¢
    startScreen.classList.add('hidden');
    mainGameScreen.classList.remove('hidden');
    resultScreen.classList.add('hidden');
    
    // æ›´æ–°çŠ¶æ€æ 
    updateStatusBars();
    
    // ç”Ÿæˆåˆå§‹éœ€æ±‚
    generateNewNeed();
    
    // ç”Ÿæˆåˆå§‹é€‰é¡¹
    generateOptions();
    
    // å¼€å§‹è®¡æ—¶
    startTimer();
}

// é¡µé¢åŠ è½½å®Œæˆåï¼Œæ˜¾ç¤ºå¼€å§‹ç•Œé¢å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬
document.addEventListener('DOMContentLoaded', () => {
    // æ˜¾ç¤ºæ­£ç¡®çš„åˆå§‹ç•Œé¢
    startScreen.classList.remove('hidden');
    mainGameScreen.classList.add('hidden');
    resultScreen.classList.add('hidden');
    
    // ç¡®ä¿æŒ‰é’®å­˜åœ¨åå†æ·»åŠ äº‹ä»¶ç›‘å¬
    if (startGameBtn) {
        startGameBtn.addEventListener('click', initGame);
        console.log('Start game button event listener added');
    } else {
        console.error('Start game button not found');
    }
    
    if (restartGameBtn) {
        restartGameBtn.addEventListener('click', initGame);
        console.log('Restart game button event listener added');
    } else {
        console.error('Restart game button not found');
    }
    
    // è°ƒè¯•æ—¥å¿—
    console.log('Game initialized and ready to start');
});
    </script>
