<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¸ˆå§æ¨¡æ‹Ÿå™¨ - å­¦æœ¯é—®ç­”æŒ‘æˆ˜</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            background-color: #f5f5f5;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
        }
        .option-btn:hover {
            background-color: #f0f7ff;
        }
        .progress-bar {
            height: 12px;
            border-radius: 6px;
            background-color: #e2e8f0;
            overflow: hidden;
        }
        .progress-fill {
            height: 100%;
            border-radius: 6px;
            transition: width 0.5s ease-out;
        }
        @keyframes timerAnimation {
            from { width: 100%; background-color: #60a5fa; }
            50% { background-color: #f59e0b; }
            to { width: 0%; background-color: #ef4444; }
        }
        .timer-bar {
            height: 6px;
            border-radius: 3px;
            background-color: #60a5fa;
            width: 100%;
            animation-name: timerAnimation;
            animation-timing-function: linear;
            animation-play-state: paused;
        }
        .timer-active {
            animation-play-state: running;
        }
        .event-notification {
            animation: fadeInOut 4s ease-in-out;
            opacity: 0;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 50;
        }
        @keyframes fadeInOut {
            0% { opacity: 0; }
            10% { opacity: 1; }
            80% { opacity: 1; }
            100% { opacity: 0; }
        }
    </style>
</head>
<body class="bg-gray-100">
    <div class="max-w-md mx-auto bg-white shadow-sm min-h-screen relative">
        <!-- é¡¶éƒ¨æ ‡é¢˜ -->
        <div class="text-center py-4 border-b border-gray-200">
            <h1 class="text-xl font-bold text-blue-800">å¸ˆå§æ¨¡æ‹Ÿå™¨ - å­¦æœ¯é—®ç­”æŒ‘æˆ˜</h1>
            <p class="text-gray-500 text-sm">æ£€éªŒä½ çš„å­¦æœ¯æ°´å¹³</p>
        </div>
        
        <!-- éšæœºäº‹ä»¶é€šçŸ¥ -->
        <div id="event-notification" class="event-notification hidden">
            <div class="bg-red-100 border-l-4 border-red-600 text-red-700 p-4 rounded shadow-lg">
                <p class="font-bold mb-1" id="event-title">çªå‘äº‹ä»¶</p>
                <p id="event-desc">é­”é­”çªç„¶æƒ³èµ·äº†ä½ ä¸Šä¸ªæœˆå¿˜è®°å¥¹ç”Ÿæ—¥çš„äº‹æƒ…ï¼</p>
            </div>
        </div>
        
        <!-- æ¸¸æˆç•Œé¢å®¹å™¨ -->
        <div id="game-container">
            <!-- å¼€å§‹æ¸¸æˆç•Œé¢ -->
            <div id="start-screen" class="p-4">
                <h2 class="text-lg font-bold mb-4 text-blue-800">å¸ˆå§å­¦æœ¯é—®ç­”æŒ‘æˆ˜</h2>
                
                <p class="mb-3 font-bold text-blue-700">æŒ‘æˆ˜ï¼šå›ç­”å¸ˆå§çš„å­¦æœ¯é—®é¢˜ï¼Œå±•ç¤ºä½ çš„ä¸“ä¸šæ°´å¹³ï¼</p>
                
                <div class="my-4 bg-gray-50 p-3 rounded">
                    <h3 class="font-bold mb-2">æ¸¸æˆè§„åˆ™ï¼š</h3>
                    <ul class="mb-3 pl-4 space-y-1 text-sm">
                        <li>â€¢ åˆå§‹æ•°å€¼ä¸º30</li>
                        <li>â€¢ èƒœåˆ©æ¡ä»¶ï¼šå¸ˆå§å¿ƒæƒ…å’ŒçŸ¥è¯†æ°´å¹³éœ€è¾¾95+</li>
                        <li>â€¢ å›åˆæ•°åªæœ‰5è½®</li>
                        <li>â€¢ æ¯è½®é™æ—¶30ç§’</li>
                        <li>â€¢ ç­”é”™ä¼šé™ä½å¸ˆå§å¿ƒæƒ…</li>
                        <li>â€¢ ç­”å¯¹ä¼šæå‡çŸ¥è¯†æ°´å¹³</li>
                    </ul>
                </div>
                
                <button id="start-game-btn" class="w-full py-2 bg-blue-100 text-blue-800 border border-blue-200 rounded text-center">
                    å¼€å§‹æŒ‘æˆ˜
                </button>
            </div>
            
            <!-- ä¸»æ¸¸æˆç•Œé¢ -->
            <div id="main-game-screen" class="hidden">
                <!-- é—®é¢˜æè¿° -->
                <div class="p-4">
                    <p id="scene-description" class="text-gray-700">
                        å¸ˆå§æ­£åœ¨è€ƒå¯Ÿä½ çš„å­¦æœ¯æ°´å¹³ï¼Œè¯·è®¤çœŸå›ç­”å¥¹çš„é—®é¢˜ã€‚
                    </p>
                    
                    <div class="my-4 pl-3 border-l-4 border-blue-500">
                        <p class="font-bold text-blue-600 mb-1">å¸ˆå§ï¼š</p>
                        <p id="shijie-quote" class="text-gray-800">"è¯·å›ç­”ä»¥ä¸‹é—®é¢˜..."</p>
                    </div>
                </div>
                
                <!-- çŠ¶æ€æŒ‡æ ‡ -->
                <div class="px-4 py-3 bg-gray-50">
                    <!-- å¸ˆå§å¿ƒæƒ…å€¼ -->
                    <div class="flex justify-between items-center mb-1">
                        <span class="text-sm text-gray-600">å¸ˆå§å¿ƒæƒ…å€¼</span>
                        <div class="flex items-center">
                            <span id="shijie-mood-emoji" class="mr-1">ğŸ˜ </span>
                            <span id="shijie-mood-value" class="text-sm font-medium">30</span>
                        </div>
                    </div>
                    <div class="progress-bar mb-3">
                        <div id="shijie-mood-bar" class="progress-fill bg-blue-500" style="width: 30%"></div>
                    </div>
                    
                    <!-- çŸ¥è¯†æ°´å¹³ -->
                    <div class="flex justify-between items-center mb-1">
                        <span class="text-sm text-gray-600">çŸ¥è¯†æ°´å¹³</span>
                        <div class="flex items-center">
                            <span id="knowledge-emoji" class="mr-1">ğŸ“š</span>
                            <span id="knowledge-value" class="text-sm font-medium">30</span>
                        </div>
                    </div>
                    <div class="progress-bar">
                        <div id="knowledge-bar" class="progress-fill bg-blue-500" style="width: 30%"></div>
                    </div>
                </div>
                
                <!-- å›åˆå’Œå€’è®¡æ—¶ -->
                <div class="p-4 pt-2 pb-0 flex justify-between items-center">
                    <span class="text-sm font-medium" id="round-counter">ç¬¬1/5è½®</span>
                    <span class="text-sm font-medium" id="timer-text">å‰©ä½™æ—¶é—´: 30ç§’</span>
                </div>
                <div class="px-4 pt-1 pb-1">
                    <div class="timer-bar" id="timer-bar"></div>
                </div>
                
                <!-- é€‰é¡¹åŒºåŸŸ -->
                <div id="options-container" class="p-4">
                    <!-- é€‰é¡¹å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                </div>
            </div>
            
            <!-- ç»“æœç•Œé¢ -->
            <div id="result-screen" class="hidden p-4">
                <div class="border-l-4 pl-3 mb-6" id="result-border">
                    <h2 id="result-title" class="text-lg font-bold mb-2">æŒ‘æˆ˜ç»“æŸ</h2>
                    
                    <p id="result-desc" class="mb-4">
                        ç»“æœæè¿°...
                    </p>
                    
                    <div class="mb-4">
                        <p class="font-medium mb-1">æœ€ç»ˆæŒ‡æ ‡ï¼š</p>
                        <div class="flex justify-between items-center mb-1">
                            <span class="text-sm">å¸ˆå§å¿ƒæƒ…å€¼ï¼š</span>
                            <div class="flex items-center">
                                <span id="final-shijie-emoji" class="mr-1">ğŸ˜Š</span>
                                <span id="final-shijie-mood" class="font-medium">85</span>
                            </div>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-sm">çŸ¥è¯†æ°´å¹³ï¼š</span>
                            <div class="flex items-center">
                                <span id="final-knowledge-emoji" class="mr-1">ğŸ“š</span>
                                <span id="final-knowledge" class="font-medium">80</span>
                            </div>
                        </div>
                    </div>
                    
                    <p id="shijie-final-quote" class="italic text-gray-700 mb-3">"å¸ˆå§çš„æœ€ç»ˆè¯„ä»·..."</p>
                    
                    <div class="bg-gray-50 p-3 rounded mb-4 text-sm">
                        <p class="font-medium mb-1">æ¸¸æˆæ•°æ®ï¼š</p>
                        <div class="flex justify-between mb-1">
                            <span>ç­”å¯¹é¢˜ç›®æ•°ï¼š</span>
                            <span id="correct-answers">0</span>
                        </div>
                        <div class="flex justify-between">
                            <span>ç­”é”™é¢˜ç›®æ•°ï¼š</span>
                            <span id="wrong-answers">0</span>
                        </div>
                    </div>
                </div>
                
                <button id="restart-game-btn" class="w-full py-2 bg-blue-100 text-blue-800 border border-blue-200 rounded text-center">
                    é‡æ–°æŒ‘æˆ˜
                </button>
            </div>
        </div>
    </div>
    
    <script>
        // æ¸¸æˆçŠ¶æ€
const gameState = {
    shijieMood: 30,           // å¸ˆå§å¿ƒæƒ…å€¼
    knowledge: 30,            // çŸ¥è¯†æ°´å¹³
    gameOver: false,          // æ¸¸æˆæ˜¯å¦ç»“æŸ
    round: 0,                 // å½“å‰è½®æ•°
    maxRounds: 5,             // æœ€å¤§è½®æ•°
    timeoutCount: 0,          // è¶…æ—¶æ¬¡æ•°
    eventCount: 0,            // éšæœºäº‹ä»¶è§¦å‘æ¬¡æ•°
    timerDuration: 30         // è®¡æ—¶å™¨æŒç»­æ—¶é—´ï¼ˆç§’ï¼‰
};

// é€‰é¡¹ç±»å‹
const optionTypes = {
    APOLOGY: "é“æ­‰",
    GIFT: "ç¤¼ç‰©",
    PHYSICAL: "è‚¢ä½“æ¥è§¦",
    QUALITY_TIME: "é™ªä¼´",
    PROMISE: "æ‰¿è¯º",
    DISTRACTION: "è½¬ç§»æ³¨æ„åŠ›",
    SELF_EXPLANATION: "è§£é‡Šè‡ªå·±"
};

// éœ€æ±‚ç±»å‹æè¿°
const needDescriptions = {
    [optionTypes.APOLOGY]: "é­”é­”å¸Œæœ›å¬åˆ°çœŸè¯šçš„é“æ­‰",
    [optionTypes.GIFT]: "é­”é­”æƒ³è¦æ”¶åˆ°ç¤¼ç‰©å’ŒæƒŠå–œ",
    [optionTypes.PHYSICAL]: "é­”é­”éœ€è¦è‚¢ä½“æ¥è§¦çš„å®‰æ…°",
    [optionTypes.QUALITY_TIME]: "é­”é­”éœ€è¦é«˜è´¨é‡çš„é™ªä¼´æ—¶é—´",
    [optionTypes.PROMISE]: "é­”é­”éœ€è¦çœ‹åˆ°å…·ä½“çš„æ”¹å˜æ‰¿è¯º",
    [optionTypes.DISTRACTION]: "é­”é­”éœ€è¦ä¸€äº›å¿«ä¹çš„è½¬ç§»æ³¨æ„åŠ›",
    [optionTypes.SELF_EXPLANATION]: "é­”é­”æƒ³å¬ä½ è§£é‡Šå·¥ä½œçš„è¾›è‹¦"
};

// é­”é­”çš„è´Ÿé¢å’Œæ­£é¢è¯è¯­
const shijieNegativePhrases = [
    "ä¸ç†ä½ äº†ï¼å‹¾çŸ³ï¼",
    "ä½ æ ¹æœ¬ä¸æ‡‚æˆ‘ï¼",
    "æˆ‘å¾ˆç”Ÿæ°”ï¼",
    "ä½ æ€»æ˜¯è¿™æ ·ï¼",
    "æˆ‘æ¨æ­»ä½ äº†ï¼",
    "ä½ æ ¹æœ¬ä¸åœ¨ä¹æˆ‘ï¼",
    "æˆ‘æ„Ÿè§‰ä½ ä¸€ç‚¹éƒ½ä¸çˆ±æˆ‘...",
    "ä½ å°±çŸ¥é“å·¥ä½œï¼Œéƒ½ä¸é™ªæˆ‘ï¼"
];

const shijiePositivePhrases = [
    "æ£’æ£’ï¼",
    "çœŸå¯çˆ±~",
    "èµçŒ«ï¼",
    "å©å©æœ€å¥½äº†ï¼",
    "å‹‰å¼ºåŸè°…ä½ ä¸€ä¸‹ä¸‹~",
    "å—¯...ä½ è¿˜ç®—æœ‰ç‚¹è‰¯å¿ƒ",
    "å¥½å•¦å¥½å•¦ï¼Œä¸ç”Ÿæ°”äº†~",
    "å©å©ï¼Œçˆ±ä½ å“¦~"
];

// éšæœºäº‹ä»¶
const randomEventsData = [
    {
        title: "å›å¿†æ¶Œç°",
        desc: "é­”é­”çªç„¶æƒ³èµ·äº†ä½ ä¸Šä¸ªæœˆå¿˜è®°å¥¹ç”Ÿæ—¥çš„äº‹æƒ…ï¼",
        moodEffect: -15,
        loveEffect: -10
    },
    {
        title: "å¥½å‹å½±å“",
        desc: "é­”é­”çš„é—ºèœœå‘æ¥æ¶ˆæ¯ï¼Œè¯´ä½ è‚¯å®šæ˜¯æ•·è¡å¥¹ï¼",
        moodEffect: -10,
        loveEffect: -15
    },
    {
        title: "æƒ…ç»ªçˆ†å‘",
        desc: "é­”é­”çªç„¶æƒ…ç»ªå´©æºƒï¼Œå¼€å§‹æ— å£°è½æ³ª...",
        moodEffect: -20,
        loveEffect: -5
    },
    {
        title: "è¿‡å¾€ä¼¤ç—›",
        desc: "é­”é­”æƒ³èµ·äº†ä½ ä»¬ä¹‹å‰çš„äº‰åµï¼Œæƒ…ç»ªæ€¥å‰§æ¶åŒ–ï¼",
        moodEffect: -15,
        loveEffect: -15
    },
    {
        title: "æ¶ˆææ€è€ƒ",
        desc: "é­”é­”æ€€ç–‘ä½ æ˜¯ä¸æ˜¯ä¸å†çˆ±å¥¹äº†...",
        moodEffect: -5,
        loveEffect: -20
    }
];

// é€‰é¡¹æ± 
const optionPool = [
    // é“æ­‰ç±»é€‰é¡¹
    { 
        text: "å¯¹ä¸èµ·ï¼Œé­”é­”ï¼Œæˆ‘ä¸åº”è¯¥è¯´é‚£äº›è¯ä¼¤å®³ä½ çš„æ„Ÿå—ã€‚", 
        mood: 12, 
        love: 10, 
        self: -5,
        type: optionTypes.APOLOGY 
    },
    { 
        text: "é­”é­”ï¼Œæˆ‘çœŸçš„å¾ˆæŠ±æ­‰ï¼Œæˆ‘è¯´è¯ä¸ç»æ€è€ƒï¼Œä¼¤å®³äº†ä½ ã€‚", 
        mood: 15, 
        love: 12, 
        self: -8,
        type: optionTypes.APOLOGY 
    },
    { 
        text: "æˆ‘é”™äº†ï¼Œé‚£äº›è¯æˆ‘ä¸è¯¥è¯´ï¼Œä¼¤å®³äº†ä½ æˆ‘å¾ˆåæ‚”ã€‚", 
        mood: 10, 
        love: 8, 
        self: -10,
        type: optionTypes.APOLOGY 
    },
    
    // ç¤¼ç‰©ç±»é€‰é¡¹
    { 
        text: "æˆ‘ç»™ä½ ä¹°äº†ä½ æœ€å–œæ¬¢çš„å¥¶èŒ¶ï¼ŒåŠ äº†ä¸¤ä»½çç ã€‚", 
        mood: 8, 
        love: 12, 
        self: -8,
        type: optionTypes.GIFT 
    },
    { 
        text: "çœ‹ï¼Œæˆ‘å·å·ç»™ä½ å‡†å¤‡äº†è¿™ä¸ªå°ç¤¼ç‰©ï¼Œå¸Œæœ›ä½ ä¼šå–œæ¬¢ã€‚", 
        mood: 10, 
        love: 15, 
        self: -10,
        type: optionTypes.GIFT 
    },
    { 
        text: "ç»™é­”é­”ä¹°äº†ä½ æœ€çˆ±åƒçš„è‚‰è‚‰ï¼Œç°åœ¨å°±å»åšç»™ä½ åƒï¼", 
        mood: 12, 
        love: 18, 
        self: -8,
        type: optionTypes.GIFT 
    },
    
    // è‚¢ä½“æ¥è§¦ç±»é€‰é¡¹
    { 
        text: "è¿‡æ¥ï¼Œäº²äº²é­”é­”~", 
        mood: 15, 
        love: 18, 
        self: -5,
        type: optionTypes.PHYSICAL 
    },
    { 
        text: "è¦ä¸è¦æŠ±æŠ±ï¼Ÿæˆ‘çŸ¥é“æŠ±æŠ±å¯ä»¥è®©ä½ èˆ’æœä¸€ç‚¹ã€‚", 
        mood: 12, 
        love: 15, 
        self: -3,
        type: optionTypes.PHYSICAL 
    },
    { 
        text: "æ¥ï¼Œä¸¾é«˜é«˜ï¼", 
        mood: 18, 
        love: 15, 
        self: -8,
        type: optionTypes.PHYSICAL 
    },
    
    // é«˜è´¨é‡é™ªä¼´é€‰é¡¹
    { 
        text: "æˆ‘ä»¬ä¸€èµ·å»åƒä½ æœ€å–œæ¬¢çš„é‚£å®¶ç«é”…å§ï¼Ÿæˆ‘çŸ¥é“ä½ æƒ³å»å¾ˆä¹…äº†ã€‚", 
        mood: 10, 
        love: 12, 
        self: -3,
        type: optionTypes.QUALITY_TIME 
    },
    { 
        text: "è¦ä¸æˆ‘ä»¬ä¸€èµ·å‡ºå»æ•£æ•£æ­¥ï¼Ÿæ•£æ­¥æ—¶æˆ‘å¯ä»¥å¬ä½ è¯´è¯´å¿ƒé‡Œçš„æƒ³æ³•ã€‚", 
        mood: 12, 
        love: 15, 
        self: 0,
        type: optionTypes.QUALITY_TIME 
    },
    { 
        text: "é­”é­”ï¼Œæˆ‘ä»¬ä¸€èµ·çœ‹ä¸ªç”µå½±æ”¾æ¾ä¸€ä¸‹å§ã€‚ä½ æŒ‘ä½ å–œæ¬¢çš„ï¼", 
        mood: 8, 
        love: 10, 
        self: 0,
        type: optionTypes.QUALITY_TIME 
    },
    
    // æ‰¿è¯ºç±»é€‰é¡¹
    { 
        text: "æˆ‘ä»¥åä¼šæ›´æ³¨æ„è‡ªå·±çš„è¨€è¡Œï¼Œä¸ä¼šå†è¿™æ ·ä¼¤å®³ä½ äº†ã€‚", 
        mood: 8, 
        love: 12, 
        self: -5,
        type: optionTypes.PROMISE 
    },
    { 
        text: "æˆ‘ä¿è¯ä»¥åä¼šå¤šèŠ±æ—¶é—´é™ªä½ ï¼ŒæŠŠä½ æ”¾åœ¨ç¬¬ä¸€ä½ã€‚", 
        mood: 12, 
        love: 15, 
        self: -8,
        type: optionTypes.PROMISE 
    },
    { 
        text: "æˆ‘ä¼šæ”¹å˜ï¼ŒçœŸçš„ã€‚ä»ä»Šå¤©å¼€å§‹ï¼Œæˆ‘ä¼šæ›´å…³å¿ƒä½ çš„æ„Ÿå—ã€‚", 
        mood: 10, 
        love: 12, 
        self: -5,
        type: optionTypes.PROMISE 
    },
    
    // è½¬ç§»æ³¨æ„åŠ›é€‰é¡¹
    { 
        text: "ç»™ä½ çœ‹æˆ‘çè—çš„æç¬‘è§†é¢‘ï¼Œä¿è¯è®©ä½ ç¬‘ã€‚", 
        mood: 8, 
        love: 5, 
        self: 3,
        type: optionTypes.DISTRACTION 
    },
    { 
        text: "æˆ‘ç»™ä½ è·³ä¸ªèˆå§ï¼æˆ‘å·å·ç»ƒäº†å¥½ä¹…ï¼Œå°±ç­‰ç€ç»™ä½ çœ‹å‘¢ã€‚", 
        mood: 15, 
        love: 18, 
        self: -8,
        type: optionTypes.DISTRACTION 
    },
    { 
        text: "é­”é­”ï¼Œè®©æˆ‘ç»™ä½ æŒ æŒ ç—’ç—’å§ï¼ŒçŸ¥é“ä½ æœ€å–œæ¬¢è¿™ä¸ªäº†ã€‚", 
        mood: 18, 
        love: 20, 
        self: -5,
        type: optionTypes.DISTRACTION 
    },
    
    // è§£é‡Šå·¥ä½œå¿™çš„é€‰é¡¹
    { 
        text: "å¯¹ä¸èµ·é­”é­”ï¼Œæˆ‘è¿™å‡ å¤©workå¤ªå¿™äº†ï¼Œæ²¡æœ‰ç…§é¡¾å¥½ä½ çš„æ„Ÿå—ã€‚", 
        mood: 15, 
        love: 18, 
        self: -5,
        type: optionTypes.SELF_EXPLANATION 
    },
    { 
        text: "æˆ‘è¿™æ®µæ—¶é—´workå¤ªå¿™äº†ï¼Œä¸åº”è¯¥æŠŠæƒ…ç»ªå¸¦ç»™ä½ ï¼Œæˆ‘å¾ˆæŠ±æ­‰ã€‚", 
        mood: 12, 
        love: 15, 
        self: -8,
        type: optionTypes.SELF_EXPLANATION 
    },
    { 
        text: "æˆ‘çŸ¥é“æˆ‘æœ€è¿‘å¤ªå¿™äº†ï¼Œæ²¡æœ‰é™ªä½ ï¼Œè®©ä½ æ„Ÿåˆ°è¢«å¿½è§†äº†ï¼Œå¯¹ä¸èµ·ã€‚", 
        mood: 15, 
        love: 20, 
        self: -5,
        type: optionTypes.SELF_EXPLANATION 
    },
    
    // è´Ÿé¢é€‰é¡¹
    { 
        text: "ä½ å…ˆå†·é™ä¸€ä¸‹ï¼Œç­‰ä½ æ°”æ¶ˆäº†æˆ‘ä»¬å†è°ˆå§ã€‚", 
        mood: -15, 
        love: -20, 
        self: 5,
        type: optionTypes.APOLOGY 
    },
    { 
        text: "æˆ‘ä¸€å®šæ˜¯å¤ªç´¯äº†æ‰ä¼šé‚£æ ·è¯´è¯ï¼ŒåŸè°…æˆ‘å¥½å—ï¼Ÿ", 
        mood: -5, 
        love: -5, 
        self: 10,
        type: optionTypes.SELF_EXPLANATION 
    },
    { 
        text: "è¦ä¸æˆ‘ä»¬è¿˜æ˜¯ä¿æŒç‚¹è·ç¦»å†·é™ä¸€ä¸‹å§ã€‚", 
        mood: -20, 
        love: -15, 
        self: 8,
        type: optionTypes.QUALITY_TIME 
    }
];

// å­¦æœ¯é—®é¢˜åº“
const academicQuestions = [
    // COIPç›¸å…³
    {
        question: "åœ¨COIPå®éªŒä¸­ï¼Œä¸ºä»€ä¹ˆéœ€è¦ä½¿ç”¨éå˜æ€§è£‚è§£æ¶²ï¼Ÿ",
        options: [
            { text: "ä¿æŒè›‹ç™½è´¨çš„å¤©ç„¶æ„è±¡å’Œç›¸äº’ä½œç”¨", correct: true, mood: 2, knowledge: 3 },
            { text: "æé«˜è›‹ç™½è´¨çš„æº¶è§£åº¦", correct: false, mood: -2, knowledge: 0 },
            { text: "å¢åŠ æŠ—ä½“çš„ç»“åˆæ•ˆç‡", correct: false, mood: -1, knowledge: 0 },
            { text: "å‡å°‘èƒŒæ™¯ä¿¡å·", correct: false, mood: -1, knowledge: 0 }
        ]
    },
    {
        question: "COIPå®éªŒä¸­ï¼Œä¸ºä»€ä¹ˆéœ€è¦è®¾ç½®IgGå¯¹ç…§ï¼Ÿ",
        options: [
            { text: "æ’é™¤éç‰¹å¼‚æ€§ç»“åˆ", correct: true, mood: 2, knowledge: 3 },
            { text: "å¢åŠ å®éªŒçš„çµæ•åº¦", correct: false, mood: -2, knowledge: 0 },
            { text: "æé«˜æŠ—ä½“çš„ç‰¹å¼‚æ€§", correct: false, mood: -1, knowledge: 0 },
            { text: "å‡å°‘å®éªŒæˆæœ¬", correct: false, mood: -1, knowledge: 0 }
        ]
    },
    // WBç›¸å…³
    {
        question: "Western Blotä¸­ï¼Œä¸ºä»€ä¹ˆéœ€è¦ä½¿ç”¨å°é—­æ¶²ï¼Ÿ",
        options: [
            { text: "é˜²æ­¢éç‰¹å¼‚æ€§ç»“åˆ", correct: true, mood: 2, knowledge: 3 },
            { text: "å¢åŠ æŠ—ä½“çš„ç»“åˆæ•ˆç‡", correct: false, mood: -2, knowledge: 0 },
            { text: "æé«˜è›‹ç™½è´¨çš„è½¬ç§»æ•ˆç‡", correct: false, mood: -1, knowledge: 0 },
            { text: "å‡å°‘èƒŒæ™¯ä¿¡å·", correct: false, mood: -1, knowledge: 0 }
        ]
    },
    {
        question: "åœ¨WBå®éªŒä¸­ï¼Œä¸ºä»€ä¹ˆéœ€è¦ä½¿ç”¨å†…å‚ï¼Ÿ",
        options: [
            { text: "ä½œä¸ºä¸Šæ ·é‡å¯¹ç…§", correct: true, mood: 2, knowledge: 3 },
            { text: "å¢åŠ å®éªŒçš„çµæ•åº¦", correct: false, mood: -2, knowledge: 0 },
            { text: "æé«˜æŠ—ä½“çš„ç‰¹å¼‚æ€§", correct: false, mood: -1, knowledge: 0 },
            { text: "å‡å°‘å®éªŒæˆæœ¬", correct: false, mood: -1, knowledge: 0 }
        ]
    },
    // è›‹ç™½çº¯åŒ–ç›¸å…³
    {
        question: "åœ¨Hisæ ‡ç­¾è›‹ç™½çº¯åŒ–ä¸­ï¼Œä¸ºä»€ä¹ˆéœ€è¦åŠ å…¥å’ªå”‘ï¼Ÿ",
        options: [
            { text: "ç«äº‰æ€§æ´—è„±Hisæ ‡ç­¾è›‹ç™½", correct: true, mood: 2, knowledge: 3 },
            { text: "å¢åŠ è›‹ç™½è´¨çš„æº¶è§£åº¦", correct: false, mood: -2, knowledge: 0 },
            { text: "æé«˜çº¯åŒ–æ•ˆç‡", correct: false, mood: -1, knowledge: 0 },
            { text: "å‡å°‘èƒŒæ™¯æ±¡æŸ“", correct: false, mood: -1, knowledge: 0 }
        ]
    },
    {
        question: "åœ¨GSTæ ‡ç­¾è›‹ç™½çº¯åŒ–ä¸­ï¼Œä¸ºä»€ä¹ˆä½¿ç”¨è°·èƒ±ç”˜è‚½ä½œä¸ºæ´—è„±æ¶²ï¼Ÿ",
        options: [
            { text: "ç«äº‰æ€§ç»“åˆGSTæ ‡ç­¾", correct: true, mood: 2, knowledge: 3 },
            { text: "å¢åŠ è›‹ç™½è´¨çš„ç¨³å®šæ€§", correct: false, mood: -2, knowledge: 0 },
            { text: "æé«˜çº¯åŒ–æ•ˆç‡", correct: false, mood: -1, knowledge: 0 },
            { text: "å‡å°‘èƒŒæ™¯æ±¡æŸ“", correct: false, mood: -1, knowledge: 0 }
        ]
    },
    // åˆ†å­å…‹éš†ç›¸å…³
    {
        question: "åœ¨PCRååº”ä¸­ï¼Œä¸ºä»€ä¹ˆéœ€è¦è®¾è®¡å¼•ç‰©ï¼Ÿ",
        options: [
            { text: "ç‰¹å¼‚æ€§æ‰©å¢ç›®æ ‡åºåˆ—", correct: true, mood: 2, knowledge: 3 },
            { text: "å¢åŠ DNAçš„ç¨³å®šæ€§", correct: false, mood: -2, knowledge: 0 },
            { text: "æé«˜ååº”æ•ˆç‡", correct: false, mood: -1, knowledge: 0 },
            { text: "å‡å°‘èƒŒæ™¯æ±¡æŸ“", correct: false, mood: -1, knowledge: 0 }
        ]
    },
    {
        question: "åœ¨è´¨ç²’æ„å»ºä¸­ï¼Œä¸ºä»€ä¹ˆéœ€è¦è®¾è®¡é…¶åˆ‡ä½ç‚¹ï¼Ÿ",
        options: [
            { text: "å®ç°DNAç‰‡æ®µçš„å®šå‘æ’å…¥", correct: true, mood: 2, knowledge: 3 },
            { text: "å¢åŠ è´¨ç²’çš„ç¨³å®šæ€§", correct: false, mood: -2, knowledge: 0 },
            { text: "æé«˜è½¬åŒ–æ•ˆç‡", correct: false, mood: -1, knowledge: 0 },
            { text: "å‡å°‘èƒŒæ™¯æ±¡æŸ“", correct: false, mood: -1, knowledge: 0 }
        ]
    }
];

// å¸ˆå§åé¦ˆä¿¡æ¯
const shijieFeedbacks = [
    { min: 0, max: 20, text: "å¸ˆå§éå¸¸å¤±æœ›ï¼Œå¥¹è§‰å¾—ä½ çš„åŸºç¡€çŸ¥è¯†å¤ªè–„å¼±äº†ã€‚", emoji: "ğŸ˜¡", phrase: "è¿™äº›åŸºç¡€é—®é¢˜éƒ½ä¸ä¼šï¼Œä½ æ˜¯æ€ä¹ˆé€šè¿‡è€ƒè¯•çš„ï¼Ÿ" },
    { min: 21, max: 40, text: "å¸ˆå§çš±ç€çœ‰å¤´ï¼Œå¯¹ä½ çš„å›ç­”ä¸å¤ªæ»¡æ„ã€‚", emoji: "ğŸ˜ ", phrase: "è¿™ä¸ªç­”æ¡ˆä¸å¤Ÿå‡†ç¡®ï¼Œå†æƒ³æƒ³ã€‚" },
    { min: 41, max: 60, text: "å¸ˆå§çš„è¡¨æƒ…ç¼“å’Œäº†ä¸€äº›ï¼Œä½†è¿˜åœ¨æ€è€ƒä½ çš„ç­”æ¡ˆã€‚", emoji: "ğŸ˜’", phrase: "å—¯...å‹‰å¼ºåŠæ ¼å§ã€‚" },
    { min: 61, max: 80, text: "å¸ˆå§ç‚¹ç‚¹å¤´ï¼Œå¯¹ä½ çš„å›ç­”è¡¨ç¤ºè®¤å¯ã€‚", emoji: "ğŸ˜", phrase: "ä¸é”™ï¼Œçœ‹æ¥ä½ ç¡®å®æœ‰è®¤çœŸå­¦ä¹ ã€‚" },
    { min: 81, max: 89, text: "å¸ˆå§éœ²å‡ºèµè®¸çš„ç¬‘å®¹ï¼Œå¯¹ä½ çš„è¡¨ç°å¾ˆæ»¡æ„ã€‚", emoji: "ğŸ˜Š", phrase: "å¾ˆå¥½ï¼ä½ çš„åŸºç¡€çŸ¥è¯†å¾ˆæ‰å®ã€‚" },
    { min: 90, max: 100, text: "å¸ˆå§éå¸¸é«˜å…´ï¼Œå¯¹ä½ çš„ä¸“ä¸šæ°´å¹³èµä¸ç»å£ï¼", emoji: "ğŸ˜", phrase: "å¤ªæ£’äº†ï¼ä½ å®Œå…¨æŒæ¡äº†è¿™äº›çŸ¥è¯†ç‚¹ï¼" }
];

// DOMå…ƒç´ 
const startScreen = document.getElementById('start-screen');
const mainGameScreen = document.getElementById('main-game-screen');
const resultScreen = document.getElementById('result-screen');
const startGameBtn = document.getElementById('start-game-btn');
const restartGameBtn = document.getElementById('restart-game-btn');
const shijieMoodBar = document.getElementById('shijie-mood-bar');
const shijieMoodValue = document.getElementById('shijie-mood-value');
const shijieMoodEmoji = document.getElementById('shijie-mood-emoji');
const knowledgeBar = document.getElementById('knowledge-bar');
const knowledgeValue = document.getElementById('knowledge-value');
const knowledgeEmoji = document.getElementById('knowledge-emoji');
const shijieQuote = document.getElementById('shijie-quote');
const optionsContainer = document.getElementById('options-container');
const sceneDescription = document.getElementById('scene-description');
const roundCounter = document.getElementById('round-counter');
const timerBar = document.getElementById('timer-bar');
const timerText = document.getElementById('timer-text');
const eventNotification = document.getElementById('event-notification');
const eventTitle = document.getElementById('event-title');
const eventDesc = document.getElementById('event-desc');

// ç»“æœç•Œé¢å…ƒç´ 
const resultTitle = document.getElementById('result-title');
const resultDesc = document.getElementById('result-desc');
const resultBorder = document.getElementById('result-border');
const finalShijieMood = document.getElementById('final-shijie-mood');
const finalKnowledge = document.getElementById('final-knowledge');
const finalShijieEmoji = document.getElementById('final-shijie-emoji');
const finalKnowledgeEmoji = document.getElementById('final-knowledge-emoji');
const correctAnswers = document.getElementById('correct-answers');
const wrongAnswers = document.getElementById('wrong-answers');

// è®¡æ—¶å™¨ç›¸å…³å˜é‡
let timerInterval;
let timeLeft;

// å¼€å§‹è®¡æ—¶å™¨
function startTimer() {
    // æ¸…é™¤ä¹‹å‰çš„è®¡æ—¶å™¨
    if (timerInterval) {
        clearInterval(timerInterval);
    }
    
    // é‡ç½®è®¡æ—¶å™¨
    timeLeft = gameState.timerDuration;
    timerText.textContent = `å‰©ä½™æ—¶é—´: ${timeLeft}ç§’`;
    
    // é‡ç½®è®¡æ—¶å™¨æ ·å¼
    timerBar.style.animationDuration = `${gameState.timerDuration}s`;
    timerBar.classList.remove('timer-active');
    // å¼ºåˆ¶é‡ç»˜
    void timerBar.offsetWidth;
    timerBar.classList.add('timer-active');
    
    // å¯åŠ¨è®¡æ—¶å™¨
    timerInterval = setInterval(() => {
        timeLeft--;
        timerText.textContent = `å‰©ä½™æ—¶é—´: ${timeLeft}ç§’`;
        
        if (timeLeft <= 0) {
            // è®¡æ—¶ç»“æŸ
            clearInterval(timerInterval);
            handleTimeout();
        }
    }, 1000);
}

// å¤„ç†ç­”æ¡ˆ
function handleAnswer(option) {
    // åœæ­¢è®¡æ—¶å™¨
    clearInterval(timerInterval);
    timerBar.classList.remove('timer-active');
    
    // æ›´æ–°æ¸¸æˆçŠ¶æ€
    gameState.shijieMood = Math.max(0, Math.min(100, gameState.shijieMood + option.mood));
    gameState.knowledge = Math.max(0, Math.min(100, gameState.knowledge + option.knowledge));
    
    // æ›´æ–°çŠ¶æ€æ 
    updateStatusBars();
    
    // æ£€æŸ¥æ˜¯å¦åº”è¯¥ç»§ç»­æ¸¸æˆ
    if (gameState.round >= gameState.maxRounds) {
        endGame();
    } else {
        // å¢åŠ å›åˆæ•°
        gameState.round++;
        // æ›´æ–°å›åˆæ˜¾ç¤º
        roundCounter.textContent = `ç¬¬${gameState.round}/${gameState.maxRounds}è½®`;
        // ç”Ÿæˆæ–°çš„é—®é¢˜
        generateQuestion();
        // å¼€å§‹æ–°ä¸€è½®è®¡æ—¶
        startTimer();
    }
}

// å¤„ç†è¶…æ—¶
function handleTimeout() {
    // å¢åŠ è¶…æ—¶è®¡æ•°
    gameState.timeoutCount++;
    
    // å› ä¸ºè¶…æ—¶æ²¡æœ‰åšå‡ºé€‰æ‹©ï¼Œé™ä½å¸ˆå§å¿ƒæƒ…å’ŒçŸ¥è¯†æ°´å¹³
    gameState.shijieMood = Math.max(0, gameState.shijieMood - 5);
    gameState.knowledge = Math.max(0, gameState.knowledge - 4);
    
    // æ›´æ–°çŠ¶æ€æ 
    updateStatusBars();
    
    // æ£€æŸ¥æ˜¯å¦åº”è¯¥ç»§ç»­æ¸¸æˆ
    if (gameState.round >= gameState.maxRounds) {
        endGame();
    } else {
        // å¢åŠ å›åˆæ•°
        gameState.round++;
        // æ›´æ–°å›åˆæ˜¾ç¤º
        roundCounter.textContent = `ç¬¬${gameState.round}/${gameState.maxRounds}è½®`;
        // ç”Ÿæˆæ–°çš„é—®é¢˜
        generateQuestion();
        // å¼€å§‹æ–°ä¸€è½®è®¡æ—¶
        startTimer();
    }
}

// ç»§ç»­æ¸¸æˆ
function continueGame() {
    // å¢åŠ å›åˆæ•°
    gameState.round++;
    
    // æ›´æ–°å›åˆæ˜¾ç¤º
    roundCounter.textContent = `ç¬¬${gameState.round}/${gameState.maxRounds}è½®`;
    
    // ç”Ÿæˆæ–°çš„é—®é¢˜
    generateQuestion();
    
    // å¼€å§‹æ–°ä¸€è½®è®¡æ—¶
    startTimer();
}

// ç”Ÿæˆéšæœºé—®é¢˜
function generateQuestion() {
    const randomIndex = Math.floor(Math.random() * academicQuestions.length);
    const question = academicQuestions[randomIndex];
    
    // æ›´æ–°é—®é¢˜æ˜¾ç¤º
    shijieQuote.textContent = `"${question.question}"`;
    
    // ç”Ÿæˆé€‰é¡¹
    optionsContainer.innerHTML = '';
    question.options.forEach(option => {
        const button = document.createElement('button');
        button.className = 'option-btn w-full p-3 mb-2 text-left border border-gray-200 rounded hover:bg-blue-50 transition';
        button.textContent = option.text;
        
        button.addEventListener('click', () => {
            handleAnswer(option);
        });
        
        optionsContainer.appendChild(button);
    });
}

// æ›´æ–°çŠ¶æ€æ 
function updateStatusBars() {
    shijieMoodBar.style.width = `${gameState.shijieMood}%`;
    shijieMoodValue.textContent = gameState.shijieMood;
    
    knowledgeBar.style.width = `${gameState.knowledge}%`;
    knowledgeValue.textContent = gameState.knowledge;
    
    // æ ¹æ®å¿ƒæƒ…å€¼æ›´æ–°çŠ¶æ€æ é¢œè‰²å’Œè¡¨æƒ…
    updateBarColors();
    
    // æ›´æ–°å¸ˆå§çš„åé¦ˆ
    updateShijieFeedback();
}

// æ›´æ–°çŠ¶æ€æ é¢œè‰²å’Œè¡¨æƒ…
function updateBarColors() {
    // å¸ˆå§å¿ƒæƒ…å€¼é¢œè‰²å’Œè¡¨æƒ…
    if (gameState.shijieMood < 30) {
        shijieMoodBar.className = "progress-fill bg-red-500";
        shijieMoodEmoji.textContent = "ğŸ˜¡";
    } else if (gameState.shijieMood < 60) {
        shijieMoodBar.className = "progress-fill bg-orange-400";
        shijieMoodEmoji.textContent = "ğŸ˜ ";
    } else if (gameState.shijieMood < 80) {
        shijieMoodBar.className = "progress-fill bg-yellow-400";
        shijieMoodEmoji.textContent = "ğŸ˜";
    } else if (gameState.shijieMood < 95) {
        shijieMoodBar.className = "progress-fill bg-green-400";
        shijieMoodEmoji.textContent = "ğŸ˜Š";
    } else {
        shijieMoodBar.className = "progress-fill bg-green-500";
        shijieMoodEmoji.textContent = "ğŸ˜";
    }
    
    // çŸ¥è¯†æ°´å¹³é¢œè‰²å’Œè¡¨æƒ…
    if (gameState.knowledge < 30) {
        knowledgeBar.className = "progress-fill bg-red-500";
        knowledgeEmoji.textContent = "ğŸ“š";
    } else if (gameState.knowledge < 60) {
        knowledgeBar.className = "progress-fill bg-orange-400";
        knowledgeEmoji.textContent = "ğŸ“š";
    } else if (gameState.knowledge < 80) {
        knowledgeBar.className = "progress-fill bg-yellow-400";
        knowledgeEmoji.textContent = "ğŸ“š";
    } else if (gameState.knowledge < 95) {
        knowledgeBar.className = "progress-fill bg-green-400";
        knowledgeEmoji.textContent = "ğŸ“š";
    } else {
        knowledgeBar.className = "progress-fill bg-green-500";
        knowledgeEmoji.textContent = "ğŸ“š";
    }
}

// æ›´æ–°å¸ˆå§çš„åé¦ˆ
function updateShijieFeedback() {
    // æ ¹æ®å¸ˆå§å¿ƒæƒ…å€¼è·å–å¯¹åº”çš„åé¦ˆ
    const feedback = shijieFeedbacks.find(f => gameState.shijieMood >= f.min && gameState.shijieMood <= f.max);
    
    // æ›´æ–°åœºæ™¯æè¿°
    sceneDescription.textContent = feedback.text;
}

// åˆå§‹åŒ–æ¸¸æˆ
function initGame() {
    console.log('Game initialization started');
    
    // é‡ç½®æ¸¸æˆçŠ¶æ€
    gameState.shijieMood = 30;
    gameState.knowledge = 30;
    gameState.gameOver = false;
    gameState.round = 1;  // ä»ç¬¬1è½®å¼€å§‹
    gameState.timeoutCount = 0;
    gameState.eventCount = 0;
    
    // æ˜¾ç¤ºæ¸¸æˆç•Œé¢ï¼Œéšè—ç»“æœç•Œé¢
    startScreen.classList.add('hidden');
    mainGameScreen.classList.remove('hidden');
    resultScreen.classList.add('hidden');
    
    // æ›´æ–°çŠ¶æ€æ 
    updateStatusBars();
    
    // ç”Ÿæˆç¬¬ä¸€ä¸ªé—®é¢˜
    generateQuestion();
    
    // å¼€å§‹è®¡æ—¶
    startTimer();
}

// é¡µé¢åŠ è½½å®Œæˆåï¼Œæ˜¾ç¤ºå¼€å§‹ç•Œé¢å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬
document.addEventListener('DOMContentLoaded', () => {
    console.log('DOM loaded');
    
    // æ˜¾ç¤ºæ­£ç¡®çš„åˆå§‹ç•Œé¢
    startScreen.classList.remove('hidden');
    mainGameScreen.classList.add('hidden');
    resultScreen.classList.add('hidden');
    
    // ç¡®ä¿æŒ‰é’®å­˜åœ¨åå†æ·»åŠ äº‹ä»¶ç›‘å¬
    if (startGameBtn) {
        startGameBtn.addEventListener('click', initGame);
        console.log('Start game button event listener added');
    } else {
        console.error('Start game button not found');
    }
    
    if (restartGameBtn) {
        restartGameBtn.addEventListener('click', initGame);
        console.log('Restart game button event listener added');
    } else {
        console.error('Restart game button not found');
    }
    
    // è°ƒè¯•æ—¥å¿—
    console.log('Game initialized and ready to start');
});
    </script>
