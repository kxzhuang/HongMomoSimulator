<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>师姐模拟器 - 学术问答挑战</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            background-color: #f5f5f5;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
        }
        .option-btn:hover {
            background-color: #f0f7ff;
        }
        .progress-bar {
            height: 12px;
            border-radius: 6px;
            background-color: #e2e8f0;
            overflow: hidden;
        }
        .progress-fill {
            height: 100%;
            border-radius: 6px;
            transition: width 0.5s ease-out;
        }
        @keyframes timerAnimation {
            from { width: 100%; background-color: #60a5fa; }
            50% { background-color: #f59e0b; }
            to { width: 0%; background-color: #ef4444; }
        }
        .timer-bar {
            height: 6px;
            border-radius: 3px;
            background-color: #60a5fa;
            width: 100%;
            animation-name: timerAnimation;
            animation-timing-function: linear;
            animation-play-state: paused;
        }
        .timer-active {
            animation-play-state: running;
        }
        .event-notification {
            animation: fadeInOut 4s ease-in-out;
            opacity: 0;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 50;
        }
        @keyframes fadeInOut {
            0% { opacity: 0; }
            10% { opacity: 1; }
            80% { opacity: 1; }
            100% { opacity: 0; }
        }
    </style>
</head>
<body class="bg-gray-100">
    <div class="max-w-md mx-auto bg-white shadow-sm min-h-screen relative">
        <!-- 顶部标题 -->
        <div class="text-center py-4 border-b border-gray-200">
            <h1 class="text-xl font-bold text-blue-800">师姐模拟器 - 学术问答挑战</h1>
            <p class="text-gray-500 text-sm">检验你的学术水平</p>
        </div>
        
        <!-- 随机事件通知 -->
        <div id="event-notification" class="event-notification hidden">
            <div class="bg-red-100 border-l-4 border-red-600 text-red-700 p-4 rounded shadow-lg">
                <p class="font-bold mb-1" id="event-title">突发事件</p>
                <p id="event-desc">魔魔突然想起了你上个月忘记她生日的事情！</p>
            </div>
        </div>
        
        <!-- 游戏界面容器 -->
        <div id="game-container">
            <!-- 开始游戏界面 -->
            <div id="start-screen" class="p-4">
                <h2 class="text-lg font-bold mb-4 text-blue-800">师姐学术问答挑战</h2>
                
                <p class="mb-3 font-bold text-blue-700">挑战：回答师姐的学术问题，展示你的专业水平！</p>
                
                <div class="my-4 bg-gray-50 p-3 rounded">
                    <h3 class="font-bold mb-2">游戏规则：</h3>
                    <ul class="mb-3 pl-4 space-y-1 text-sm">
                        <li>• 初始数值为30</li>
                        <li>• 胜利条件：师姐心情和知识水平需达95+</li>
                        <li>• 回合数只有5轮</li>
                        <li>• 每轮限时30秒</li>
                        <li>• 答错会降低师姐心情</li>
                        <li>• 答对会提升知识水平</li>
                    </ul>
                </div>
                
                <button id="start-game-btn" class="w-full py-2 bg-blue-100 text-blue-800 border border-blue-200 rounded text-center">
                    开始挑战
                </button>
            </div>
            
            <!-- 主游戏界面 -->
            <div id="main-game-screen" class="hidden">
                <!-- 问题描述 -->
                <div class="p-4">
                    <p id="scene-description" class="text-gray-700">
                        师姐正在考察你的学术水平，请认真回答她的问题。
                    </p>
                    
                    <div class="my-4 pl-3 border-l-4 border-blue-500">
                        <p class="font-bold text-blue-600 mb-1">师姐：</p>
                        <p id="shijie-quote" class="text-gray-800">"请回答以下问题..."</p>
                    </div>
                </div>
                
                <!-- 状态指标 -->
                <div class="px-4 py-3 bg-gray-50">
                    <!-- 师姐心情值 -->
                    <div class="flex justify-between items-center mb-1">
                        <span class="text-sm text-gray-600">师姐心情值</span>
                        <div class="flex items-center">
                            <span id="shijie-mood-emoji" class="mr-1">😠</span>
                            <span id="shijie-mood-value" class="text-sm font-medium">30</span>
                        </div>
                    </div>
                    <div class="progress-bar mb-3">
                        <div id="shijie-mood-bar" class="progress-fill bg-blue-500" style="width: 30%"></div>
                    </div>
                    
                    <!-- 知识水平 -->
                    <div class="flex justify-between items-center mb-1">
                        <span class="text-sm text-gray-600">知识水平</span>
                        <div class="flex items-center">
                            <span id="knowledge-emoji" class="mr-1">📚</span>
                            <span id="knowledge-value" class="text-sm font-medium">30</span>
                        </div>
                    </div>
                    <div class="progress-bar">
                        <div id="knowledge-bar" class="progress-fill bg-blue-500" style="width: 30%"></div>
                    </div>
                </div>
                
                <!-- 回合和倒计时 -->
                <div class="p-4 pt-2 pb-0 flex justify-between items-center">
                    <span class="text-sm font-medium" id="round-counter">第1/5轮</span>
                    <span class="text-sm font-medium" id="timer-text">剩余时间: 30秒</span>
                </div>
                <div class="px-4 pt-1 pb-1">
                    <div class="timer-bar" id="timer-bar"></div>
                </div>
                
                <!-- 选项区域 -->
                <div id="options-container" class="p-4">
                    <!-- 选项将通过JavaScript动态生成 -->
                </div>
            </div>
            
            <!-- 结果界面 -->
            <div id="result-screen" class="hidden p-4">
                <div class="border-l-4 pl-3 mb-6" id="result-border">
                    <h2 id="result-title" class="text-lg font-bold mb-2">挑战结束</h2>
                    
                    <p id="result-desc" class="mb-4">
                        结果描述...
                    </p>
                    
                    <div class="mb-4">
                        <p class="font-medium mb-1">最终指标：</p>
                        <div class="flex justify-between items-center mb-1">
                            <span class="text-sm">师姐心情值：</span>
                            <div class="flex items-center">
                                <span id="final-shijie-emoji" class="mr-1">😊</span>
                                <span id="final-shijie-mood" class="font-medium">85</span>
                            </div>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-sm">知识水平：</span>
                            <div class="flex items-center">
                                <span id="final-knowledge-emoji" class="mr-1">📚</span>
                                <span id="final-knowledge" class="font-medium">80</span>
                            </div>
                        </div>
                    </div>
                    
                    <p id="shijie-final-quote" class="italic text-gray-700 mb-3">"师姐的最终评价..."</p>
                    
                    <div class="bg-gray-50 p-3 rounded mb-4 text-sm">
                        <p class="font-medium mb-1">游戏数据：</p>
                        <div class="flex justify-between mb-1">
                            <span>答对题目数：</span>
                            <span id="correct-answers">0</span>
                        </div>
                        <div class="flex justify-between">
                            <span>答错题目数：</span>
                            <span id="wrong-answers">0</span>
                        </div>
                    </div>
                </div>
                
                <button id="restart-game-btn" class="w-full py-2 bg-blue-100 text-blue-800 border border-blue-200 rounded text-center">
                    重新挑战
                </button>
            </div>
        </div>
    </div>
    
    <script>
        // 游戏状态
const gameState = {
    shijieMood: 30,           // 师姐心情值
    knowledge: 30,            // 知识水平
    gameOver: false,          // 游戏是否结束
    round: 0,                 // 当前轮数
    maxRounds: 5,             // 最大轮数
    timeoutCount: 0,          // 超时次数
    eventCount: 0,            // 随机事件触发次数
    timerDuration: 30         // 计时器持续时间（秒）
};

// 选项类型
const optionTypes = {
    APOLOGY: "道歉",
    GIFT: "礼物",
    PHYSICAL: "肢体接触",
    QUALITY_TIME: "陪伴",
    PROMISE: "承诺",
    DISTRACTION: "转移注意力",
    SELF_EXPLANATION: "解释自己"
};

// 需求类型描述
const needDescriptions = {
    [optionTypes.APOLOGY]: "魔魔希望听到真诚的道歉",
    [optionTypes.GIFT]: "魔魔想要收到礼物和惊喜",
    [optionTypes.PHYSICAL]: "魔魔需要肢体接触的安慰",
    [optionTypes.QUALITY_TIME]: "魔魔需要高质量的陪伴时间",
    [optionTypes.PROMISE]: "魔魔需要看到具体的改变承诺",
    [optionTypes.DISTRACTION]: "魔魔需要一些快乐的转移注意力",
    [optionTypes.SELF_EXPLANATION]: "魔魔想听你解释工作的辛苦"
};

// 魔魔的负面和正面话语
const shijieNegativePhrases = [
    "不理你了！勾石！",
    "你根本不懂我！",
    "我很生气！",
    "你总是这样！",
    "我恨死你了！",
    "你根本不在乎我！",
    "我感觉你一点都不爱我...",
    "你就知道工作，都不陪我！"
];

const shijiePositivePhrases = [
    "棒棒！",
    "真可爱~",
    "赏猫！",
    "叩叩最好了！",
    "勉强原谅你一下下~",
    "嗯...你还算有点良心",
    "好啦好啦，不生气了~",
    "叩叩，爱你哦~"
];

// 随机事件
const randomEventsData = [
    {
        title: "回忆涌现",
        desc: "魔魔突然想起了你上个月忘记她生日的事情！",
        moodEffect: -15,
        loveEffect: -10
    },
    {
        title: "好友影响",
        desc: "魔魔的闺蜜发来消息，说你肯定是敷衍她！",
        moodEffect: -10,
        loveEffect: -15
    },
    {
        title: "情绪爆发",
        desc: "魔魔突然情绪崩溃，开始无声落泪...",
        moodEffect: -20,
        loveEffect: -5
    },
    {
        title: "过往伤痛",
        desc: "魔魔想起了你们之前的争吵，情绪急剧恶化！",
        moodEffect: -15,
        loveEffect: -15
    },
    {
        title: "消极思考",
        desc: "魔魔怀疑你是不是不再爱她了...",
        moodEffect: -5,
        loveEffect: -20
    }
];

// 选项池
const optionPool = [
    // 道歉类选项
    { 
        text: "对不起，魔魔，我不应该说那些话伤害你的感受。", 
        mood: 12, 
        love: 10, 
        self: -5,
        type: optionTypes.APOLOGY 
    },
    { 
        text: "魔魔，我真的很抱歉，我说话不经思考，伤害了你。", 
        mood: 15, 
        love: 12, 
        self: -8,
        type: optionTypes.APOLOGY 
    },
    { 
        text: "我错了，那些话我不该说，伤害了你我很后悔。", 
        mood: 10, 
        love: 8, 
        self: -10,
        type: optionTypes.APOLOGY 
    },
    
    // 礼物类选项
    { 
        text: "我给你买了你最喜欢的奶茶，加了两份珍珠。", 
        mood: 8, 
        love: 12, 
        self: -8,
        type: optionTypes.GIFT 
    },
    { 
        text: "看，我偷偷给你准备了这个小礼物，希望你会喜欢。", 
        mood: 10, 
        love: 15, 
        self: -10,
        type: optionTypes.GIFT 
    },
    { 
        text: "给魔魔买了你最爱吃的肉肉，现在就去做给你吃！", 
        mood: 12, 
        love: 18, 
        self: -8,
        type: optionTypes.GIFT 
    },
    
    // 肢体接触类选项
    { 
        text: "过来，亲亲魔魔~", 
        mood: 15, 
        love: 18, 
        self: -5,
        type: optionTypes.PHYSICAL 
    },
    { 
        text: "要不要抱抱？我知道抱抱可以让你舒服一点。", 
        mood: 12, 
        love: 15, 
        self: -3,
        type: optionTypes.PHYSICAL 
    },
    { 
        text: "来，举高高！", 
        mood: 18, 
        love: 15, 
        self: -8,
        type: optionTypes.PHYSICAL 
    },
    
    // 高质量陪伴选项
    { 
        text: "我们一起去吃你最喜欢的那家火锅吧？我知道你想去很久了。", 
        mood: 10, 
        love: 12, 
        self: -3,
        type: optionTypes.QUALITY_TIME 
    },
    { 
        text: "要不我们一起出去散散步？散步时我可以听你说说心里的想法。", 
        mood: 12, 
        love: 15, 
        self: 0,
        type: optionTypes.QUALITY_TIME 
    },
    { 
        text: "魔魔，我们一起看个电影放松一下吧。你挑你喜欢的！", 
        mood: 8, 
        love: 10, 
        self: 0,
        type: optionTypes.QUALITY_TIME 
    },
    
    // 承诺类选项
    { 
        text: "我以后会更注意自己的言行，不会再这样伤害你了。", 
        mood: 8, 
        love: 12, 
        self: -5,
        type: optionTypes.PROMISE 
    },
    { 
        text: "我保证以后会多花时间陪你，把你放在第一位。", 
        mood: 12, 
        love: 15, 
        self: -8,
        type: optionTypes.PROMISE 
    },
    { 
        text: "我会改变，真的。从今天开始，我会更关心你的感受。", 
        mood: 10, 
        love: 12, 
        self: -5,
        type: optionTypes.PROMISE 
    },
    
    // 转移注意力选项
    { 
        text: "给你看我珍藏的搞笑视频，保证让你笑。", 
        mood: 8, 
        love: 5, 
        self: 3,
        type: optionTypes.DISTRACTION 
    },
    { 
        text: "我给你跳个舞吧！我偷偷练了好久，就等着给你看呢。", 
        mood: 15, 
        love: 18, 
        self: -8,
        type: optionTypes.DISTRACTION 
    },
    { 
        text: "魔魔，让我给你挠挠痒痒吧，知道你最喜欢这个了。", 
        mood: 18, 
        love: 20, 
        self: -5,
        type: optionTypes.DISTRACTION 
    },
    
    // 解释工作忙的选项
    { 
        text: "对不起魔魔，我这几天work太忙了，没有照顾好你的感受。", 
        mood: 15, 
        love: 18, 
        self: -5,
        type: optionTypes.SELF_EXPLANATION 
    },
    { 
        text: "我这段时间work太忙了，不应该把情绪带给你，我很抱歉。", 
        mood: 12, 
        love: 15, 
        self: -8,
        type: optionTypes.SELF_EXPLANATION 
    },
    { 
        text: "我知道我最近太忙了，没有陪你，让你感到被忽视了，对不起。", 
        mood: 15, 
        love: 20, 
        self: -5,
        type: optionTypes.SELF_EXPLANATION 
    },
    
    // 负面选项
    { 
        text: "你先冷静一下，等你气消了我们再谈吧。", 
        mood: -15, 
        love: -20, 
        self: 5,
        type: optionTypes.APOLOGY 
    },
    { 
        text: "我一定是太累了才会那样说话，原谅我好吗？", 
        mood: -5, 
        love: -5, 
        self: 10,
        type: optionTypes.SELF_EXPLANATION 
    },
    { 
        text: "要不我们还是保持点距离冷静一下吧。", 
        mood: -20, 
        love: -15, 
        self: 8,
        type: optionTypes.QUALITY_TIME 
    }
];

// 学术问题库
const academicQuestions = [
    // COIP相关
    {
        question: "在COIP实验中，为什么需要使用非变性裂解液？",
        options: [
            { text: "保持蛋白质的天然构象和相互作用", correct: true, mood: 2, knowledge: 3 },
            { text: "提高蛋白质的溶解度", correct: false, mood: -2, knowledge: 0 },
            { text: "增加抗体的结合效率", correct: false, mood: -1, knowledge: 0 },
            { text: "减少背景信号", correct: false, mood: -1, knowledge: 0 }
        ]
    },
    {
        question: "COIP实验中，为什么需要设置IgG对照？",
        options: [
            { text: "排除非特异性结合", correct: true, mood: 2, knowledge: 3 },
            { text: "增加实验的灵敏度", correct: false, mood: -2, knowledge: 0 },
            { text: "提高抗体的特异性", correct: false, mood: -1, knowledge: 0 },
            { text: "减少实验成本", correct: false, mood: -1, knowledge: 0 }
        ]
    },
    // WB相关
    {
        question: "Western Blot中，为什么需要使用封闭液？",
        options: [
            { text: "防止非特异性结合", correct: true, mood: 2, knowledge: 3 },
            { text: "增加抗体的结合效率", correct: false, mood: -2, knowledge: 0 },
            { text: "提高蛋白质的转移效率", correct: false, mood: -1, knowledge: 0 },
            { text: "减少背景信号", correct: false, mood: -1, knowledge: 0 }
        ]
    },
    {
        question: "在WB实验中，为什么需要使用内参？",
        options: [
            { text: "作为上样量对照", correct: true, mood: 2, knowledge: 3 },
            { text: "增加实验的灵敏度", correct: false, mood: -2, knowledge: 0 },
            { text: "提高抗体的特异性", correct: false, mood: -1, knowledge: 0 },
            { text: "减少实验成本", correct: false, mood: -1, knowledge: 0 }
        ]
    },
    // 蛋白纯化相关
    {
        question: "在His标签蛋白纯化中，为什么需要加入咪唑？",
        options: [
            { text: "竞争性洗脱His标签蛋白", correct: true, mood: 2, knowledge: 3 },
            { text: "增加蛋白质的溶解度", correct: false, mood: -2, knowledge: 0 },
            { text: "提高纯化效率", correct: false, mood: -1, knowledge: 0 },
            { text: "减少背景污染", correct: false, mood: -1, knowledge: 0 }
        ]
    },
    {
        question: "在GST标签蛋白纯化中，为什么使用谷胱甘肽作为洗脱液？",
        options: [
            { text: "竞争性结合GST标签", correct: true, mood: 2, knowledge: 3 },
            { text: "增加蛋白质的稳定性", correct: false, mood: -2, knowledge: 0 },
            { text: "提高纯化效率", correct: false, mood: -1, knowledge: 0 },
            { text: "减少背景污染", correct: false, mood: -1, knowledge: 0 }
        ]
    },
    // 分子克隆相关
    {
        question: "在PCR反应中，为什么需要设计引物？",
        options: [
            { text: "特异性扩增目标序列", correct: true, mood: 2, knowledge: 3 },
            { text: "增加DNA的稳定性", correct: false, mood: -2, knowledge: 0 },
            { text: "提高反应效率", correct: false, mood: -1, knowledge: 0 },
            { text: "减少背景污染", correct: false, mood: -1, knowledge: 0 }
        ]
    },
    {
        question: "在质粒构建中，为什么需要设计酶切位点？",
        options: [
            { text: "实现DNA片段的定向插入", correct: true, mood: 2, knowledge: 3 },
            { text: "增加质粒的稳定性", correct: false, mood: -2, knowledge: 0 },
            { text: "提高转化效率", correct: false, mood: -1, knowledge: 0 },
            { text: "减少背景污染", correct: false, mood: -1, knowledge: 0 }
        ]
    }
];

// 师姐反馈信息
const shijieFeedbacks = [
    { min: 0, max: 20, text: "师姐非常失望，她觉得你的基础知识太薄弱了。", emoji: "😡", phrase: "这些基础问题都不会，你是怎么通过考试的？" },
    { min: 21, max: 40, text: "师姐皱着眉头，对你的回答不太满意。", emoji: "😠", phrase: "这个答案不够准确，再想想。" },
    { min: 41, max: 60, text: "师姐的表情缓和了一些，但还在思考你的答案。", emoji: "😒", phrase: "嗯...勉强及格吧。" },
    { min: 61, max: 80, text: "师姐点点头，对你的回答表示认可。", emoji: "😐", phrase: "不错，看来你确实有认真学习。" },
    { min: 81, max: 89, text: "师姐露出赞许的笑容，对你的表现很满意。", emoji: "😊", phrase: "很好！你的基础知识很扎实。" },
    { min: 90, max: 100, text: "师姐非常高兴，对你的专业水平赞不绝口！", emoji: "😍", phrase: "太棒了！你完全掌握了这些知识点！" }
];

// DOM元素
const startScreen = document.getElementById('start-screen');
const mainGameScreen = document.getElementById('main-game-screen');
const resultScreen = document.getElementById('result-screen');
const startGameBtn = document.getElementById('start-game-btn');
const restartGameBtn = document.getElementById('restart-game-btn');
const shijieMoodBar = document.getElementById('shijie-mood-bar');
const shijieMoodValue = document.getElementById('shijie-mood-value');
const shijieMoodEmoji = document.getElementById('shijie-mood-emoji');
const knowledgeBar = document.getElementById('knowledge-bar');
const knowledgeValue = document.getElementById('knowledge-value');
const knowledgeEmoji = document.getElementById('knowledge-emoji');
const shijieQuote = document.getElementById('shijie-quote');
const optionsContainer = document.getElementById('options-container');
const sceneDescription = document.getElementById('scene-description');
const roundCounter = document.getElementById('round-counter');
const timerBar = document.getElementById('timer-bar');
const timerText = document.getElementById('timer-text');
const eventNotification = document.getElementById('event-notification');
const eventTitle = document.getElementById('event-title');
const eventDesc = document.getElementById('event-desc');

// 结果界面元素
const resultTitle = document.getElementById('result-title');
const resultDesc = document.getElementById('result-desc');
const resultBorder = document.getElementById('result-border');
const finalShijieMood = document.getElementById('final-shijie-mood');
const finalKnowledge = document.getElementById('final-knowledge');
const finalShijieEmoji = document.getElementById('final-shijie-emoji');
const finalKnowledgeEmoji = document.getElementById('final-knowledge-emoji');
const correctAnswers = document.getElementById('correct-answers');
const wrongAnswers = document.getElementById('wrong-answers');

// 计时器相关变量
let timerInterval;
let timeLeft;

// 开始计时器
function startTimer() {
    // 清除之前的计时器
    if (timerInterval) {
        clearInterval(timerInterval);
    }
    
    // 重置计时器
    timeLeft = gameState.timerDuration;
    timerText.textContent = `剩余时间: ${timeLeft}秒`;
    
    // 重置计时器样式
    timerBar.style.animationDuration = `${gameState.timerDuration}s`;
    timerBar.classList.remove('timer-active');
    // 强制重绘
    void timerBar.offsetWidth;
    timerBar.classList.add('timer-active');
    
    // 启动计时器
    timerInterval = setInterval(() => {
        timeLeft--;
        timerText.textContent = `剩余时间: ${timeLeft}秒`;
        
        if (timeLeft <= 0) {
            // 计时结束
            clearInterval(timerInterval);
            handleTimeout();
        }
    }, 1000);
}

// 处理答案
function handleAnswer(option) {
    // 停止计时器
    clearInterval(timerInterval);
    timerBar.classList.remove('timer-active');
    
    // 更新游戏状态
    gameState.shijieMood = Math.max(0, Math.min(100, gameState.shijieMood + option.mood));
    gameState.knowledge = Math.max(0, Math.min(100, gameState.knowledge + option.knowledge));
    
    // 更新状态栏
    updateStatusBars();
    
    // 检查是否应该继续游戏
    if (gameState.round >= gameState.maxRounds) {
        endGame();
    } else {
        // 增加回合数
        gameState.round++;
        // 更新回合显示
        roundCounter.textContent = `第${gameState.round}/${gameState.maxRounds}轮`;
        // 生成新的问题
        generateQuestion();
        // 开始新一轮计时
        startTimer();
    }
}

// 处理超时
function handleTimeout() {
    // 增加超时计数
    gameState.timeoutCount++;
    
    // 因为超时没有做出选择，降低师姐心情和知识水平
    gameState.shijieMood = Math.max(0, gameState.shijieMood - 5);
    gameState.knowledge = Math.max(0, gameState.knowledge - 4);
    
    // 更新状态栏
    updateStatusBars();
    
    // 检查是否应该继续游戏
    if (gameState.round >= gameState.maxRounds) {
        endGame();
    } else {
        // 增加回合数
        gameState.round++;
        // 更新回合显示
        roundCounter.textContent = `第${gameState.round}/${gameState.maxRounds}轮`;
        // 生成新的问题
        generateQuestion();
        // 开始新一轮计时
        startTimer();
    }
}

// 继续游戏
function continueGame() {
    // 增加回合数
    gameState.round++;
    
    // 更新回合显示
    roundCounter.textContent = `第${gameState.round}/${gameState.maxRounds}轮`;
    
    // 生成新的问题
    generateQuestion();
    
    // 开始新一轮计时
    startTimer();
}

// 生成随机问题
function generateQuestion() {
    const randomIndex = Math.floor(Math.random() * academicQuestions.length);
    const question = academicQuestions[randomIndex];
    
    // 更新问题显示
    shijieQuote.textContent = `"${question.question}"`;
    
    // 生成选项
    optionsContainer.innerHTML = '';
    question.options.forEach(option => {
        const button = document.createElement('button');
        button.className = 'option-btn w-full p-3 mb-2 text-left border border-gray-200 rounded hover:bg-blue-50 transition';
        button.textContent = option.text;
        
        button.addEventListener('click', () => {
            handleAnswer(option);
        });
        
        optionsContainer.appendChild(button);
    });
}

// 更新状态栏
function updateStatusBars() {
    shijieMoodBar.style.width = `${gameState.shijieMood}%`;
    shijieMoodValue.textContent = gameState.shijieMood;
    
    knowledgeBar.style.width = `${gameState.knowledge}%`;
    knowledgeValue.textContent = gameState.knowledge;
    
    // 根据心情值更新状态栏颜色和表情
    updateBarColors();
    
    // 更新师姐的反馈
    updateShijieFeedback();
}

// 更新状态栏颜色和表情
function updateBarColors() {
    // 师姐心情值颜色和表情
    if (gameState.shijieMood < 30) {
        shijieMoodBar.className = "progress-fill bg-red-500";
        shijieMoodEmoji.textContent = "😡";
    } else if (gameState.shijieMood < 60) {
        shijieMoodBar.className = "progress-fill bg-orange-400";
        shijieMoodEmoji.textContent = "😠";
    } else if (gameState.shijieMood < 80) {
        shijieMoodBar.className = "progress-fill bg-yellow-400";
        shijieMoodEmoji.textContent = "😐";
    } else if (gameState.shijieMood < 95) {
        shijieMoodBar.className = "progress-fill bg-green-400";
        shijieMoodEmoji.textContent = "😊";
    } else {
        shijieMoodBar.className = "progress-fill bg-green-500";
        shijieMoodEmoji.textContent = "😍";
    }
    
    // 知识水平颜色和表情
    if (gameState.knowledge < 30) {
        knowledgeBar.className = "progress-fill bg-red-500";
        knowledgeEmoji.textContent = "📚";
    } else if (gameState.knowledge < 60) {
        knowledgeBar.className = "progress-fill bg-orange-400";
        knowledgeEmoji.textContent = "📚";
    } else if (gameState.knowledge < 80) {
        knowledgeBar.className = "progress-fill bg-yellow-400";
        knowledgeEmoji.textContent = "📚";
    } else if (gameState.knowledge < 95) {
        knowledgeBar.className = "progress-fill bg-green-400";
        knowledgeEmoji.textContent = "📚";
    } else {
        knowledgeBar.className = "progress-fill bg-green-500";
        knowledgeEmoji.textContent = "📚";
    }
}

// 更新师姐的反馈
function updateShijieFeedback() {
    // 根据师姐心情值获取对应的反馈
    const feedback = shijieFeedbacks.find(f => gameState.shijieMood >= f.min && gameState.shijieMood <= f.max);
    
    // 更新场景描述
    sceneDescription.textContent = feedback.text;
}

// 初始化游戏
function initGame() {
    console.log('Game initialization started');
    
    // 重置游戏状态
    gameState.shijieMood = 30;
    gameState.knowledge = 30;
    gameState.gameOver = false;
    gameState.round = 1;  // 从第1轮开始
    gameState.timeoutCount = 0;
    gameState.eventCount = 0;
    
    // 显示游戏界面，隐藏结果界面
    startScreen.classList.add('hidden');
    mainGameScreen.classList.remove('hidden');
    resultScreen.classList.add('hidden');
    
    // 更新状态栏
    updateStatusBars();
    
    // 生成第一个问题
    generateQuestion();
    
    // 开始计时
    startTimer();
}

// 页面加载完成后，显示开始界面并添加事件监听
document.addEventListener('DOMContentLoaded', () => {
    console.log('DOM loaded');
    
    // 显示正确的初始界面
    startScreen.classList.remove('hidden');
    mainGameScreen.classList.add('hidden');
    resultScreen.classList.add('hidden');
    
    // 确保按钮存在后再添加事件监听
    if (startGameBtn) {
        startGameBtn.addEventListener('click', initGame);
        console.log('Start game button event listener added');
    } else {
        console.error('Start game button not found');
    }
    
    if (restartGameBtn) {
        restartGameBtn.addEventListener('click', initGame);
        console.log('Restart game button event listener added');
    } else {
        console.error('Restart game button not found');
    }
    
    // 调试日志
    console.log('Game initialized and ready to start');
});
    </script>
